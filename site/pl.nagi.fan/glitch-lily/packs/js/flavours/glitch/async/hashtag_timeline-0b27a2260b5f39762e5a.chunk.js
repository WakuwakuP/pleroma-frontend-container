(window.webpackJsonp=window.webpackJsonp||[]).push([[82],{1122:function(t,a,e){"use strict";e.r(a),e.d(a,"default",(function(){return R}));var s,n=e(0),o=e(1415),l=e.n(o),i=e(1),c=e.n(i),h=e(12),d=e(1316),g=e(1302),r=e(1294),u=e(4),p=e(960),m=e.n(p),b=e(1452),_=e(1430),O=e(1315);const f=Object(u.f)({placeholder:{id:"hashtag.column_settings.select.placeholder",defaultMessage:"Enter hashtagsâ€¦"},noOptions:{id:"hashtag.column_settings.select.no_options_message",defaultMessage:"No suggestions found"}});let j=Object(u.g)(s=class extends c.a.PureComponent{constructor(){super(...arguments),this.state={open:this.hasTags()},this.onSelect=t=>a=>{const e=this.tags(t);a.length>4&&!(a<e)||this.props.onChange(["tags",t],a)},this.onToggle=()=>{this.state.open&&this.hasTags()&&this.props.onChange("tags",{}),this.setState({open:!this.state.open})},this.noOptionsMessage=()=>this.props.intl.formatMessage(f.noOptions)}hasTags(){return["all","any","none"].map((t=>this.tags(t).length>0)).includes(!0)}tags(t){let a=this.props.settings.getIn(["tags",t])||[];return a.toJS?a.toJS():a}modeSelect(t){return Object(n.a)("div",{className:"column-settings__row"},void 0,Object(n.a)("span",{className:"column-settings__section"},void 0,this.modeLabel(t)),Object(n.a)(_.a,{nonce:document.querySelector("meta[name=style-nonce]").content,cacheKey:"tags"},void 0,Object(n.a)(b.a,{isMulti:!0,autoFocus:!0,value:this.tags(t),onChange:this.onSelect(t),loadOptions:this.props.onLoad,className:"column-select__container",classNamePrefix:"column-select",name:"tags",placeholder:this.props.intl.formatMessage(f.placeholder),noOptionsMessage:this.noOptionsMessage})))}modeLabel(t){switch(t){case"any":return Object(n.a)(u.b,{id:"hashtag.column_settings.tag_mode.any",defaultMessage:"Any of these"});case"all":return Object(n.a)(u.b,{id:"hashtag.column_settings.tag_mode.all",defaultMessage:"All of these"});case"none":return Object(n.a)(u.b,{id:"hashtag.column_settings.tag_mode.none",defaultMessage:"None of these"});default:return""}}render(){const{settings:t,onChange:a}=this.props;return Object(n.a)("div",{},void 0,Object(n.a)("div",{className:"column-settings__row"},void 0,Object(n.a)("div",{className:"setting-toggle"},void 0,Object(n.a)(m.a,{id:"hashtag.column_settings.tag_toggle",onChange:this.onToggle,checked:this.state.open}),Object(n.a)("span",{className:"setting-toggle__label"},void 0,Object(n.a)(u.b,{id:"hashtag.column_settings.tag_toggle",defaultMessage:"Include additional tags in this column"})))),this.state.open&&Object(n.a)("div",{className:"column-settings__hashtags"},void 0,this.modeSelect("any"),this.modeSelect("all"),this.modeSelect("none")),Object(n.a)("div",{className:"column-settings__row"},void 0,Object(n.a)(O.a,{settings:t,settingPath:["local"],onChange:a,label:Object(n.a)(u.b,{id:"community.column_settings.local_only",defaultMessage:"Local only"})})))}})||s;var v=e(373),y=e(8);var M=Object(h.connect)(((t,a)=>{let{columnId:e}=a;const s=t.getIn(["settings","columns"]),n=s.findIndex((t=>t.get("uuid")===e));return e&&n>=0?{settings:s.get(n).get("params"),onLoad:a=>Object(y.a)((()=>t)).get("/api/v2/search",{params:{q:a,type:"hashtags"}}).then((t=>(t.data.hashtags||[]).map((t=>({value:t.name,label:"#"+t.name})))))}:{}}),((t,a)=>{let{columnId:e}=a;return{onChange(a,s){t(Object(v.f)(e,a,s))}}}))(j),w=e(41),S=e(1318);const H="HASHTAG_FETCH_REQUEST",C="HASHTAG_FETCH_SUCCESS",T="HASHTAG_FETCH_FAIL",F=()=>({type:H}),A=(t,a)=>({type:C,name:t,tag:a}),I=t=>({type:T,error:t}),L=t=>({type:"HASHTAG_FOLLOW_REQUEST",name:t}),N=(t,a)=>({type:"HASHTAG_FOLLOW_SUCCESS",name:t,tag:a}),E=(t,a)=>({type:"HASHTAG_FOLLOW_FAIL",name:t,error:a}),k=t=>({type:H,name:t}),U=(t,a)=>({type:C,name:t,tag:a}),x=(t,a)=>({type:T,name:t,error:a});var G,P=e(28),W=e(7),D=e.n(W);const J=Object(u.f)({followHashtag:{id:"hashtag.follow",defaultMessage:"Follow hashtag"},unfollowHashtag:{id:"hashtag.unfollow",defaultMessage:"Unfollow hashtag"}});let R=Object(h.connect)(((t,a)=>({hasUnread:t.getIn(["timelines","hashtag:"+a.params.id+(a.params.local?":local":""),"unread"])>0,tag:t.getIn(["tags",a.params.id])})))(G=Object(u.g)(G=class extends c.a.PureComponent{constructor(){super(...arguments),this.disconnects=[],this.handlePin=()=>{const{columnId:t,dispatch:a}=this.props;a(t?Object(v.h)(t):Object(v.e)("HASHTAG",{id:this.props.params.id}))},this.title=()=>{const{id:t}=this.props.params,a=[t];return this.additionalFor("any")&&a.push(" ",Object(n.a)(u.b,{id:"hashtag.column_header.tag_mode.any",values:{additional:this.additionalFor("any")},defaultMessage:"or {additional}"},"any")),this.additionalFor("all")&&a.push(" ",Object(n.a)(u.b,{id:"hashtag.column_header.tag_mode.all",values:{additional:this.additionalFor("all")},defaultMessage:"and {additional}"},"all")),this.additionalFor("none")&&a.push(" ",Object(n.a)(u.b,{id:"hashtag.column_header.tag_mode.none",values:{additional:this.additionalFor("none")},defaultMessage:"without {additional}"},"none")),a},this.additionalFor=t=>{const{tags:a}=this.props.params;return a&&(a[t]||[]).length>0?a[t].map((t=>t.value)).join("/"):""},this.handleMove=t=>{const{columnId:a,dispatch:e}=this.props;e(Object(v.g)(a,t))},this.handleHeaderClick=()=>{this.column.scrollTop()},this.setRef=t=>{this.column=t},this.handleLoadMore=t=>{const{dispatch:a,params:e}=this.props,{id:s,tags:n,local:o}=e;a(Object(w.u)(s,{maxId:t,tags:n,local:o}))},this.handleFollow=()=>{const{dispatch:t,params:a,tag:e}=this.props,{id:s}=a;var n;e.get("following")?t((n=s,(t,a)=>{t(k(n)),Object(y.a)(a).post("/api/v1/tags/"+n+"/unfollow").then((a=>{let{data:e}=a;t(U(n,e))})).catch((a=>{t(x(n,a))}))})):t((t=>(a,e)=>{a(L(t)),Object(y.a)(e).post("/api/v1/tags/"+t+"/follow").then((e=>{let{data:s}=e;a(N(t,s))})).catch((e=>{a(E(t,e))}))})(s))}}_subscribe(t,a,e,s){void 0===e&&(e={});let n=(e.any||[]).map((t=>t.value)),o=(e.all||[]).map((t=>t.value)),l=(e.none||[]).map((t=>t.value));[a,...n].map((e=>{this.disconnects.push(t(Object(S.c)(a,e,s,(t=>{let a=t.tags.map((t=>t.name));return o.filter((t=>a.includes(t))).length===o.length&&0===l.filter((t=>a.includes(t))).length}))))}))}_unsubscribe(){this.disconnects.map((t=>t())),this.disconnects=[]}_unload(){const{dispatch:t}=this.props,{id:a,local:e}=this.props.params;this._unsubscribe(),t(Object(w.l)("hashtag:"+a+(e?":local":"")))}_load(){const{dispatch:t}=this.props,{id:a,tags:e,local:s}=this.props.params;var n;this._subscribe(t,a,e,s),t(Object(w.u)(a,{tags:e,local:s})),t((n=a,(t,a)=>{t(F()),Object(y.a)(a).get("/api/v1/tags/"+n).then((a=>{let{data:e}=a;t(A(n,e))})).catch((a=>{t(I(a))}))}))}componentDidMount(){this._load()}componentDidUpdate(t){const{params:a}=this.props,{id:e,tags:s,local:n}=t.params;e===a.id&&l()(s,a.tags)&&l()(n,a.local)||(this._unload(),this._load())}componentWillUnmount(){this._unsubscribe()}render(){const{hasUnread:t,columnId:a,multiColumn:e,tag:s,intl:o}=this.props,{id:l,local:i}=this.props.params,h=!!a;let p;if(s){const t=s.get("following");p=Object(n.a)("button",{className:D()("column-header__button"),onClick:this.handleFollow,title:o.formatMessage(t?J.unfollowHashtag:J.followHashtag),"aria-label":o.formatMessage(t?J.unfollowHashtag:J.followHashtag),"aria-pressed":t?"true":"false"},void 0,Object(n.a)(P.a,{id:t?"user-times":"user-plus",fixedWidth:!0,className:"column-header__icon"}))}return c.a.createElement(g.a,{bindToDocument:!e,ref:this.setRef,label:"#"+l},Object(n.a)(r.a,{icon:"hashtag",active:t,title:this.title(),onPin:this.handlePin,onMove:this.handleMove,onClick:this.handleHeaderClick,pinned:h,multiColumn:e,extraButton:p,showBackButton:!0},void 0,a&&Object(n.a)(M,{columnId:a})),Object(n.a)(d.a,{trackScroll:!h,scrollKey:"hashtag_timeline-"+a,timelineId:"hashtag:"+l+(i?":local":""),onLoadMore:this.handleLoadMore,emptyMessage:Object(n.a)(u.b,{id:"empty_column.hashtag",defaultMessage:"There is nothing in this hashtag yet."}),bindToDocument:!e}))}})||G)||G}}]);
//# sourceMappingURL=hashtag_timeline-0b27a2260b5f39762e5a.chunk.js.map