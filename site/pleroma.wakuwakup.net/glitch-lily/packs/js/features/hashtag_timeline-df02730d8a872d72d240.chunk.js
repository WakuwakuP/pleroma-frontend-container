(window.webpackJsonp=window.webpackJsonp||[]).push([[47],{1030:function(t,e,a){"use strict";a.r(e),a.d(e,"default",(function(){return k}));var s,n=a(0),o=a(1415),l=a.n(o),i=a(1),c=a.n(i),h=a(12),d=a(1329),g=a(961),r=a(958),u=a(4),p=a(960),m=a.n(p),b=a(1452),_=a(1430),f=a(1328);const O=Object(u.f)({placeholder:{id:"hashtag.column_settings.select.placeholder",defaultMessage:"Enter hashtagsâ€¦"},noOptions:{id:"hashtag.column_settings.select.no_options_message",defaultMessage:"No suggestions found"}});let j=Object(u.g)(s=class extends c.a.PureComponent{constructor(){super(...arguments),this.state={open:this.hasTags()},this.onSelect=t=>e=>{const a=this.tags(t);e.length>4&&!(e<a)||this.props.onChange(["tags",t],e)},this.onToggle=()=>{this.state.open&&this.hasTags()&&this.props.onChange("tags",{}),this.setState({open:!this.state.open})},this.noOptionsMessage=()=>this.props.intl.formatMessage(O.noOptions)}hasTags(){return["all","any","none"].map((t=>this.tags(t).length>0)).includes(!0)}tags(t){let e=this.props.settings.getIn(["tags",t])||[];return e.toJS?e.toJS():e}modeSelect(t){return Object(n.a)("div",{className:"column-settings__row"},void 0,Object(n.a)("span",{className:"column-settings__section"},void 0,this.modeLabel(t)),Object(n.a)(_.a,{nonce:document.querySelector("meta[name=style-nonce]").content,cacheKey:"tags"},void 0,Object(n.a)(b.a,{isMulti:!0,autoFocus:!0,value:this.tags(t),onChange:this.onSelect(t),loadOptions:this.props.onLoad,className:"column-select__container",classNamePrefix:"column-select",name:"tags",placeholder:this.props.intl.formatMessage(O.placeholder),noOptionsMessage:this.noOptionsMessage})))}modeLabel(t){switch(t){case"any":return Object(n.a)(u.b,{id:"hashtag.column_settings.tag_mode.any",defaultMessage:"Any of these"});case"all":return Object(n.a)(u.b,{id:"hashtag.column_settings.tag_mode.all",defaultMessage:"All of these"});case"none":return Object(n.a)(u.b,{id:"hashtag.column_settings.tag_mode.none",defaultMessage:"None of these"});default:return""}}render(){const{settings:t,onChange:e}=this.props;return Object(n.a)("div",{},void 0,Object(n.a)("div",{className:"column-settings__row"},void 0,Object(n.a)("div",{className:"setting-toggle"},void 0,Object(n.a)(m.a,{id:"hashtag.column_settings.tag_toggle",onChange:this.onToggle,checked:this.state.open}),Object(n.a)("span",{className:"setting-toggle__label"},void 0,Object(n.a)(u.b,{id:"hashtag.column_settings.tag_toggle",defaultMessage:"Include additional tags in this column"})))),this.state.open&&Object(n.a)("div",{className:"column-settings__hashtags"},void 0,this.modeSelect("any"),this.modeSelect("all"),this.modeSelect("none")),Object(n.a)("div",{className:"column-settings__row"},void 0,Object(n.a)(f.a,{settings:t,settingPath:["local"],onChange:e,label:Object(n.a)(u.b,{id:"community.column_settings.local_only",defaultMessage:"Local only"})})))}})||s;var v=a(271),M=a(6);var w,y=Object(h.connect)(((t,e)=>{let{columnId:a}=e;const s=t.getIn(["settings","columns"]),n=s.findIndex((t=>t.get("uuid")===a));return a&&n>=0?{settings:s.get(n).get("params"),onLoad:e=>Object(M.a)((()=>t)).get("/api/v2/search",{params:{q:e,type:"hashtags"}}).then((t=>(t.data.hashtags||[]).map((t=>({value:t.name,label:"#"+t.name})))))}:{}}),((t,e)=>{let{columnId:a}=e;return{onChange(e,s){t(Object(v.f)(a,e,s))}}}))(j),C=a(24),I=a(967),N=a(96),S=a(20),F=a(7),H=a.n(F);const T=Object(u.f)({followHashtag:{id:"hashtag.follow",defaultMessage:"Follow hashtag"},unfollowHashtag:{id:"hashtag.unfollow",defaultMessage:"Unfollow hashtag"}});let k=Object(h.connect)(((t,e)=>({hasUnread:t.getIn(["timelines","hashtag:"+e.params.id+(e.params.local?":local":""),"unread"])>0,tag:t.getIn(["tags",e.params.id])})))(w=Object(u.g)(w=class extends c.a.PureComponent{constructor(){super(...arguments),this.disconnects=[],this.handlePin=()=>{const{columnId:t,dispatch:e}=this.props;e(t?Object(v.h)(t):Object(v.e)("HASHTAG",{id:this.props.params.id}))},this.title=()=>{const{id:t}=this.props.params,e=[t];return this.additionalFor("any")&&e.push(" ",Object(n.a)(u.b,{id:"hashtag.column_header.tag_mode.any",values:{additional:this.additionalFor("any")},defaultMessage:"or {additional}"},"any")),this.additionalFor("all")&&e.push(" ",Object(n.a)(u.b,{id:"hashtag.column_header.tag_mode.all",values:{additional:this.additionalFor("all")},defaultMessage:"and {additional}"},"all")),this.additionalFor("none")&&e.push(" ",Object(n.a)(u.b,{id:"hashtag.column_header.tag_mode.none",values:{additional:this.additionalFor("none")},defaultMessage:"without {additional}"},"none")),e},this.additionalFor=t=>{const{tags:e}=this.props.params;return e&&(e[t]||[]).length>0?e[t].map((t=>t.value)).join("/"):""},this.handleMove=t=>{const{columnId:e,dispatch:a}=this.props;a(Object(v.g)(e,t))},this.handleHeaderClick=()=>{this.column.scrollTop()},this.setRef=t=>{this.column=t},this.handleLoadMore=t=>{const{dispatch:e,params:a}=this.props,{id:s,tags:n,local:o}=a;e(Object(C.t)(s,{maxId:t,tags:n,local:o}))},this.handleFollow=()=>{const{dispatch:t,params:e,tag:a}=this.props,{id:s}=e;a.get("following")?t(Object(N.h)(s)):t(Object(N.g)(s))}}_subscribe(t,e,a,s){void 0===a&&(a={});let n=(a.any||[]).map((t=>t.value)),o=(a.all||[]).map((t=>t.value)),l=(a.none||[]).map((t=>t.value));[e,...n].map((a=>{this.disconnects.push(t(Object(I.c)(e,a,s,(t=>{let e=t.tags.map((t=>t.name));return o.filter((t=>e.includes(t))).length===o.length&&0===l.filter((t=>e.includes(t))).length}))))}))}_unsubscribe(){this.disconnects.map((t=>t())),this.disconnects=[]}_unload(){const{dispatch:t}=this.props,{id:e,local:a}=this.props.params;this._unsubscribe(),t(Object(C.l)("hashtag:"+e+(a?":local":"")))}_load(){const{dispatch:t}=this.props,{id:e,tags:a,local:s}=this.props.params;this._subscribe(t,e,a,s),t(Object(C.t)(e,{tags:a,local:s})),t(Object(N.f)(e))}componentDidMount(){this._load()}componentDidUpdate(t){const{params:e}=this.props,{id:a,tags:s,local:n}=t.params;a===e.id&&l()(s,e.tags)&&l()(n,e.local)||(this._unload(),this._load())}componentWillUnmount(){this._unsubscribe()}render(){const{hasUnread:t,columnId:e,multiColumn:a,tag:s,intl:o}=this.props,{id:l,local:i}=this.props.params,h=!!e;let p;if(s){const t=s.get("following");p=Object(n.a)("button",{className:H()("column-header__button"),onClick:this.handleFollow,title:o.formatMessage(t?T.unfollowHashtag:T.followHashtag),"aria-label":o.formatMessage(t?T.unfollowHashtag:T.followHashtag),"aria-pressed":t?"true":"false"},void 0,Object(n.a)(S.a,{id:t?"user-times":"user-plus",fixedWidth:!0,className:"column-header__icon"}))}return c.a.createElement(g.a,{bindToDocument:!a,ref:this.setRef,label:"#"+l},Object(n.a)(r.a,{icon:"hashtag",active:t,title:this.title(),onPin:this.handlePin,onMove:this.handleMove,onClick:this.handleHeaderClick,pinned:h,multiColumn:a,extraButton:p,showBackButton:!0},void 0,e&&Object(n.a)(y,{columnId:e})),Object(n.a)(d.a,{trackScroll:!h,scrollKey:"hashtag_timeline-"+e,timelineId:"hashtag:"+l+(i?":local":""),onLoadMore:this.handleLoadMore,emptyMessage:Object(n.a)(u.b,{id:"empty_column.hashtag",defaultMessage:"There is nothing in this hashtag yet."}),bindToDocument:!a}))}})||w)||w}}]);
//# sourceMappingURL=hashtag_timeline-df02730d8a872d72d240.chunk.js.map