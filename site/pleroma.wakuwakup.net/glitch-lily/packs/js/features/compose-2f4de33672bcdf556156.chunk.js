(window.webpackJsonp=window.webpackJsonp||[]).push([[30],{1027:function(e,t,s){"use strict";s.r(t),s.d(t,"default",(function(){return L}));var a,o,i=s(0),n=s(1),c=s.n(n),l=s(845),r=s(987),d=s(12),u=s(10),p=s(618),g=s(4),h=s(989),m=s(78),b=s(26),f=s.n(b),v=s(3),O=s.n(v),j=s(16),_=s.n(j),S=s(1304),C=s(1326),y=s(18),x=s(964),k=s(20),M=s(11),w=s(1327);const N=Object(g.f)({dismissSuggestion:{id:"suggestions.dismiss",defaultMessage:"Dismiss suggestion"}});let T=Object(g.g)(((o=class extends y.a{constructor(){super(...arguments),this.handleLoadMoreAccounts=()=>this.props.expandSearch("accounts"),this.handleLoadMoreStatuses=()=>this.props.expandSearch("statuses"),this.handleLoadMoreHashtags=()=>this.props.expandSearch("hashtags")}componentDidMount(){""===this.props.searchTerm&&this.props.fetchSuggestions()}componentDidUpdate(){""===this.props.searchTerm&&this.props.fetchSuggestions()}render(){const{intl:e,results:t,suggestions:s,dismissSuggestion:a,searchTerm:o}=this.props;if(""===o&&!s.isEmpty())return Object(i.a)("div",{className:"search-results"},void 0,Object(i.a)("div",{className:"trends"},void 0,Object(i.a)("div",{className:"trends__header"},void 0,Object(i.a)(k.a,{id:"user-plus",fixedWidth:!0}),Object(i.a)(g.b,{id:"suggestions.header",defaultMessage:"You might be interested in…"})),s&&s.map((t=>Object(i.a)(S.a,{id:t.get("account"),actionIcon:"past_interaction"===t.get("source")?"times":null,actionTitle:"past_interaction"===t.get("source")?e.formatMessage(N.dismissSuggestion):null,onActionClick:a},t.get("account"))))));let n,c,l,r=0;return t.get("accounts")&&t.get("accounts").size>0&&(r+=t.get("accounts").size,n=Object(i.a)("div",{className:"search-results__section"},void 0,Object(i.a)("h5",{},void 0,Object(i.a)(k.a,{id:"users",fixedWidth:!0}),Object(i.a)(g.b,{id:"search_results.accounts",defaultMessage:"People"})),t.get("accounts").map((e=>Object(i.a)(S.a,{id:e},e))),t.get("accounts").size>=5&&Object(i.a)(w.a,{visible:!0,onClick:this.handleLoadMoreAccounts}))),t.get("statuses")&&t.get("statuses").size>0?(r+=t.get("statuses").size,c=Object(i.a)("div",{className:"search-results__section"},void 0,Object(i.a)("h5",{},void 0,Object(i.a)(k.a,{id:"quote-right",fixedWidth:!0}),Object(i.a)(g.b,{id:"search_results.statuses",defaultMessage:"Posts"})),t.get("statuses").map((e=>Object(i.a)(C.a,{id:e},e))),t.get("statuses").size>=5&&Object(i.a)(w.a,{visible:!0,onClick:this.handleLoadMoreStatuses}))):!t.get("statuses")||0!==t.get("statuses").size||M.r||o.startsWith("@")||o.startsWith("#")||o.includes(" ")||(c=Object(i.a)("div",{className:"search-results__section"},void 0,Object(i.a)("h5",{},void 0,Object(i.a)(k.a,{id:"quote-right",fixedWidth:!0}),Object(i.a)(g.b,{id:"search_results.statuses",defaultMessage:"Posts"})),Object(i.a)("div",{className:"search-results__info"},void 0,Object(i.a)(g.b,{id:"search_results.statuses_fts_disabled",defaultMessage:"Searching posts by their content is not enabled on this Mastodon server."})))),t.get("hashtags")&&t.get("hashtags").size>0&&(r+=t.get("hashtags").size,l=Object(i.a)("div",{className:"search-results__section"},void 0,Object(i.a)("h5",{},void 0,Object(i.a)(k.a,{id:"hashtag",fixedWidth:!0}),Object(i.a)(g.b,{id:"search_results.hashtags",defaultMessage:"Hashtags"})),t.get("hashtags").map((e=>Object(i.a)(x.a,{hashtag:e},e.get("name")))),t.get("hashtags").size>=5&&Object(i.a)(w.a,{visible:!0,onClick:this.handleLoadMoreHashtags}))),Object(i.a)("div",{className:"search-results"},void 0,Object(i.a)("div",{className:"search-results__header"},void 0,Object(i.a)(k.a,{id:"search",fixedWidth:!0}),Object(i.a)(g.b,{id:"search_results.total",defaultMessage:"{count, number} {count, plural, one {result} other {results}}",values:{count:r}})),n,c,l)}}).propTypes={results:_.a.map.isRequired,suggestions:_.a.list.isRequired,fetchSuggestions:O.a.func.isRequired,expandSearch:O.a.func.isRequired,dismissSuggestion:O.a.func.isRequired,searchTerm:O.a.string,intl:O.a.object.isRequired},a=o))||a;var R=s(280),I=s(106);var D,q=Object(d.connect)((e=>({results:e.getIn(["search","results"]),suggestions:e.getIn(["suggestions","items"]),searchTerm:e.getIn(["search","searchTerm"])})),(e=>({fetchSuggestions:()=>e(Object(R.f)()),expandSearch:t=>e(Object(I.j)(t)),dismissSuggestion:t=>e(Object(R.e)(t.get("id")))})))(T),P=s(35),F=s(144),E=s(852);const U=Object(g.f)({start:{id:"getting_started.heading",defaultMessage:"Getting started"},home_timeline:{id:"tabs_bar.home",defaultMessage:"Home"},notifications:{id:"tabs_bar.notifications",defaultMessage:"Notifications"},public:{id:"navigation_bar.public_timeline",defaultMessage:"Federated timeline"},community:{id:"navigation_bar.community_timeline",defaultMessage:"Local timeline"},preferences:{id:"navigation_bar.preferences",defaultMessage:"Preferences"},logout:{id:"navigation_bar.logout",defaultMessage:"Logout"},compose:{id:"navigation_bar.compose",defaultMessage:"Compose new post"},logoutMessage:{id:"confirmations.logout.message",defaultMessage:"Are you sure you want to log out?"},logoutConfirm:{id:"confirmations.logout.confirm",defaultMessage:"Log out"}});let L=Object(d.connect)(((e,t)=>({columns:e.getIn(["settings","columns"]),showSearch:t.multiColumn?e.getIn(["search","submitted"])&&!e.getIn(["search","hidden"]):t.isSearchPage})))(D=Object(g.g)(D=class extends c.a.PureComponent{constructor(){super(...arguments),this.handleLogoutClick=e=>{const{dispatch:t,intl:s}=this.props;return e.preventDefault(),e.stopPropagation(),t(Object(P.d)("CONFIRM",{message:s.formatMessage(U.logoutMessage),confirm:s.formatMessage(U.logoutConfirm),closeWhenConfirm:!1,onConfirm:()=>Object(E.a)()})),!1},this.onFocus=()=>{this.props.dispatch(Object(u.db)(!0))},this.onBlur=()=>{this.props.dispatch(Object(u.db)(!1))}}componentDidMount(){const{isSearchPage:e}=this.props;e||this.props.dispatch(Object(u.pb)())}componentWillUnmount(){const{isSearchPage:e}=this.props;e||this.props.dispatch(Object(u.Ab)())}render(){const{multiColumn:e,showSearch:t,isSearchPage:s,intl:a}=this.props;let o="";if(e){const{columns:e}=this.props;o=Object(i.a)("nav",{className:"drawer__header"},void 0,Object(i.a)(p.a,{to:"/getting-started",className:"drawer__tab",title:a.formatMessage(U.start),"aria-label":a.formatMessage(U.start)},void 0,Object(i.a)(k.a,{id:"bars",fixedWidth:!0})),!e.some((e=>"HOME"===e.get("id")))&&Object(i.a)(p.a,{to:"/home",className:"drawer__tab",title:a.formatMessage(U.home_timeline),"aria-label":a.formatMessage(U.home_timeline)},void 0,Object(i.a)(k.a,{id:"home",fixedWidth:!0})),!e.some((e=>"NOTIFICATIONS"===e.get("id")))&&Object(i.a)(p.a,{to:"/notifications",className:"drawer__tab",title:a.formatMessage(U.notifications),"aria-label":a.formatMessage(U.notifications)},void 0,Object(i.a)(k.a,{id:"bell",fixedWidth:!0})),!e.some((e=>"COMMUNITY"===e.get("id")))&&Object(i.a)(p.a,{to:"/public/local",className:"drawer__tab",title:a.formatMessage(U.community),"aria-label":a.formatMessage(U.community)},void 0,Object(i.a)(k.a,{id:"users",fixedWidth:!0})),!e.some((e=>"PUBLIC"===e.get("id")))&&Object(i.a)(p.a,{to:"/public",className:"drawer__tab",title:a.formatMessage(U.public),"aria-label":a.formatMessage(U.public)},void 0,Object(i.a)(k.a,{id:"globe",fixedWidth:!0})),Object(i.a)("a",{href:"/settings/preferences",className:"drawer__tab",title:a.formatMessage(U.preferences),"aria-label":a.formatMessage(U.preferences)},void 0,Object(i.a)(k.a,{id:"cog",fixedWidth:!0})),Object(i.a)("a",{href:"/auth/sign_out",className:"drawer__tab",title:a.formatMessage(U.logout),"aria-label":a.formatMessage(U.logout),onClick:this.handleLogoutClick},void 0,Object(i.a)(k.a,{id:"sign-out",fixedWidth:!0})))}return Object(i.a)("div",{className:"drawer",role:"region","aria-label":a.formatMessage(U.compose)},void 0,o,(e||s)&&Object(i.a)(h.a,{}),Object(i.a)("div",{className:"drawer__pager"},void 0,!s&&Object(i.a)("div",{className:"drawer__inner",onFocus:this.onFocus},void 0,Object(i.a)(r.a,{onClose:this.onBlur}),Object(i.a)(l.a,{}),Object(i.a)("div",{className:"drawer__inner__mastodon"},void 0,Object(i.a)("img",{alt:"",draggable:"false",src:M.l||F.default}))),Object(i.a)(m.a,{defaultStyle:{x:s?0:-100},style:{x:f()(t||s?0:-100,{stiffness:210,damping:20})}},void 0,(e=>{let{x:t}=e;return Object(i.a)("div",{className:"drawer__inner darker",style:{transform:"translateX("+t+"%)",visibility:-100===t?"hidden":"visible"}},void 0,Object(i.a)(q,{}))}))))}})||D)||D},845:function(e,t,s){"use strict";var a,o,i=s(12),n=s(0),c=s(1),l=s.n(c),r=s(368),d=s(98),u=s(16),p=s.n(u),g=s(3),h=s.n(g),m=s(10),b=s(207),f=s(100),v=s(32),O=s(136),j=s(4),_=s(18),S=s(318);const C=Object(j.f)({cancel:{id:"reply_indicator.cancel",defaultMessage:"Cancel"}});let y=Object(j.g)(((o=class extends _.a{constructor(){super(...arguments),this.handleClick=()=>{this.props.onCancel()},this.handleAccountClick=e=>{0!==e.button||e.ctrlKey||e.metaKey||(e.preventDefault(),this.context.router.history.push("/@"+this.props.status.getIn(["account","acct"])))}}render(){const{status:e,intl:t}=this.props;if(!e)return null;const s={__html:e.get("contentHtml")};return Object(n.a)("div",{className:"reply-indicator"},void 0,Object(n.a)("div",{className:"reply-indicator__header"},void 0,Object(n.a)("div",{className:"reply-indicator__cancel"},void 0,Object(n.a)(v.a,{title:t.formatMessage(C.cancel),icon:"times",onClick:this.handleClick,inverted:!0})),Object(n.a)("a",{href:e.getIn(["account","url"]),onClick:this.handleAccountClick,className:"reply-indicator__display-name"},void 0,Object(n.a)("div",{className:"reply-indicator__display-avatar"},void 0,Object(n.a)(f.a,{account:e.get("account"),size:24})),Object(n.a)(O.a,{account:e.get("account")}))),Object(n.a)("div",{className:"reply-indicator__content translate",dangerouslySetInnerHTML:s}),e.get("media_attachments").size>0&&Object(n.a)(S.a,{compact:!0,media:e.get("media_attachments")}))}}).contextTypes={router:h.a.object},o.propTypes={status:p.a.map,onCancel:h.a.func.isRequired,intl:h.a.object.isRequired},a=o))||a;var x=Object(i.connect)((()=>{const e=Object(b.h)();return t=>{let s=t.getIn(["compose","id"],null),a=!0;return null===s&&(s=t.getIn(["compose","in_reply_to"]),a=!1),{status:e(t,{id:s}),editing:a}}}),(e=>({onCancel(){e(Object(m.W)())}})))(y);class k extends _.a{render(){const{account:e}=this.props;return Object(n.a)("div",{className:"autosuggest-account",title:e.get("acct")},void 0,Object(n.a)("div",{className:"autosuggest-account-icon"},void 0,Object(n.a)(f.a,{account:e,size:18})),Object(n.a)(O.a,{account:e}))}}k.propTypes={account:p.a.map.isRequired};var M=Object(i.connect)((()=>{const e=Object(b.d)();return(t,s)=>{let{id:a}=s;return{account:e(t,a)}}}))(k),w=s(55),N=s.n(w),T=s(67);class R extends l.a.PureComponent{render(){const{emoji:e}=this.props;let t;if(e.custom)t=e.imageUrl;else{const s=N.a[e.native]||N.a[e.native.replace(/\uFE0F$/,"")];if(!s)return null;t=T.a+"/emoji/"+s.filename+".svg"}return Object(n.a)("div",{className:"autosuggest-emoji"},void 0,Object(n.a)("img",{className:"emojione",src:t,alt:e.native||e.colons}),e.colons)}}var I=s(487);class D extends l.a.PureComponent{render(){const{tag:e}=this.props,t=e.history&&Object(n.a)(I.a,{value:e.history.reduce(((e,t)=>e+1*t.uses),0)});return Object(n.a)("div",{className:"autosuggest-hashtag"},void 0,Object(n.a)("div",{className:"autosuggest-hashtag__name"},void 0,"#",Object(n.a)("strong",{},void 0,e.name)),void 0!==e.history&&Object(n.a)("div",{className:"autosuggest-hashtag__uses"},void 0,Object(n.a)(j.b,{id:"autosuggest_hashtag.per_week",defaultMessage:"{count} per week",values:{count:t}})))}}var q=s(248),P=s(7),F=s.n(P);class E extends _.a{constructor(){super(...arguments),this.state={suggestionsHidden:!0,focused:!1,selectedSuggestion:0,lastToken:null,tokenStart:0},this.onChange=e=>{const[t,s]=((e,t)=>{let s,a=e.slice(0,t).search(/\S+$/),o=e.slice(t).search(/\s/);return s=o<0?e.slice(a):e.slice(a,o+t),!s||s.trim().length<3||-1===["@",":","#"].indexOf(s[0])?[null,null]:(s=s.trim().toLowerCase(),s.length>0?[a+1,s]:[null,null])})(e.target.value,e.target.selectionStart);null!==s&&this.state.lastToken!==s?(this.setState({lastToken:s,selectedSuggestion:0,tokenStart:t}),this.props.onSuggestionsFetchRequested(s)):null===s&&(this.setState({lastToken:null}),this.props.onSuggestionsClearRequested()),this.props.onChange(e)},this.onKeyDown=e=>{const{suggestions:t,disabled:s}=this.props,{selectedSuggestion:a,suggestionsHidden:o}=this.state;if(s)e.preventDefault();else if(229!==e.which&&!e.isComposing){switch(e.key){case"Escape":0===t.size||o?document.querySelector(".ui").parentElement.focus():(e.preventDefault(),this.setState({suggestionsHidden:!0}));break;case"ArrowDown":t.size>0&&!o&&(e.preventDefault(),this.setState({selectedSuggestion:Math.min(a+1,t.size-1)}));break;case"ArrowUp":t.size>0&&!o&&(e.preventDefault(),this.setState({selectedSuggestion:Math.max(a-1,0)}));break;case"Enter":case"Tab":null!==this.state.lastToken&&t.size>0&&!o&&(e.preventDefault(),e.stopPropagation(),this.props.onSuggestionSelected(this.state.tokenStart,this.state.lastToken,t.get(a)))}!e.defaultPrevented&&this.props.onKeyDown&&this.props.onKeyDown(e)}},this.onBlur=()=>{this.setState({suggestionsHidden:!0,focused:!1})},this.onFocus=e=>{this.setState({focused:!0}),this.props.onFocus&&this.props.onFocus(e)},this.onSuggestionClick=e=>{const t=this.props.suggestions.get(e.currentTarget.getAttribute("data-index"));e.preventDefault(),this.props.onSuggestionSelected(this.state.tokenStart,this.state.lastToken,t),this.textarea.focus()},this.setTextarea=e=>{this.textarea=e},this.onPaste=e=>{e.clipboardData&&1===e.clipboardData.files.length&&(this.props.onPaste(e.clipboardData.files),e.preventDefault())},this.renderSuggestion=(e,t)=>{const{selectedSuggestion:s}=this.state;let a,o;return"emoji"===e.type?(a=Object(n.a)(R,{emoji:e}),o=e.id):"hashtag"===e.type?(a=Object(n.a)(D,{tag:e}),o=e.name):"account"===e.type&&(a=Object(n.a)(M,{id:e.id}),o=e.id),Object(n.a)("div",{role:"button",tabIndex:"0","data-index":t,className:F()("autosuggest-textarea__suggestions__item",{selected:t===s}),onMouseDown:this.onSuggestionClick},o,a)}}componentWillReceiveProps(e){e.suggestions!==this.props.suggestions&&e.suggestions.size>0&&this.state.suggestionsHidden&&this.state.focused&&this.setState({suggestionsHidden:!1})}render(){const{value:e,suggestions:t,disabled:s,placeholder:a,onKeyUp:o,autoFocus:i,children:c}=this.props,{suggestionsHidden:r}=this.state;return[Object(n.a)("div",{className:"compose-form__autosuggest-wrapper"},"autosuggest-wrapper",Object(n.a)("div",{className:"autosuggest-textarea"},void 0,Object(n.a)("label",{},void 0,Object(n.a)("span",{style:{display:"none"}},void 0,a),l.a.createElement(q.a,{ref:this.setTextarea,className:"autosuggest-textarea__textarea",disabled:s,placeholder:a,autoFocus:i,value:e,onChange:this.onChange,onKeyDown:this.onKeyDown,onKeyUp:o,onFocus:this.onFocus,onBlur:this.onBlur,onPaste:this.onPaste,dir:"auto","aria-autocomplete":"list"}))),c),Object(n.a)("div",{className:"autosuggest-textarea__suggestions-wrapper"},"suggestions-wrapper",Object(n.a)("div",{className:"autosuggest-textarea__suggestions "+(r||t.isEmpty()?"":"autosuggest-textarea__suggestions--visible")},void 0,t.map(this.renderSuggestion)))]}}E.propTypes={value:h.a.string,suggestions:p.a.list,disabled:h.a.bool,placeholder:h.a.string,onSuggestionSelected:h.a.func.isRequired,onSuggestionsClearRequested:h.a.func.isRequired,onSuggestionsFetchRequested:h.a.func.isRequired,onChange:h.a.func.isRequired,onKeyUp:h.a.func,onKeyDown:h.a.func,onPaste:h.a.func.isRequired,autoFocus:h.a.bool},E.defaultProps={autoFocus:!0};class U extends _.a{constructor(){super(...arguments),this.state={suggestionsHidden:!0,focused:!1,selectedSuggestion:0,lastToken:null,tokenStart:0},this.onChange=e=>{const[t,s]=((e,t,s)=>{let a,o=e.slice(0,t).search(/\S+$/),i=e.slice(t).search(/\s/);return a=i<0?e.slice(o):e.slice(o,i+t),!a||a.trim().length<3||-1===s.indexOf(a[0])?[null,null]:(a=a.trim().toLowerCase(),a.length>0?[o+1,a]:[null,null])})(e.target.value,e.target.selectionStart,this.props.searchTokens);null!==s&&this.state.lastToken!==s?(this.setState({lastToken:s,selectedSuggestion:0,tokenStart:t}),this.props.onSuggestionsFetchRequested(s)):null===s&&(this.setState({lastToken:null}),this.props.onSuggestionsClearRequested()),this.props.onChange(e)},this.onKeyDown=e=>{const{suggestions:t,disabled:s}=this.props,{selectedSuggestion:a,suggestionsHidden:o}=this.state;if(s)e.preventDefault();else if(229!==e.which&&!e.isComposing){switch(e.key){case"Escape":0===t.size||o?document.querySelector(".ui").parentElement.focus():(e.preventDefault(),this.setState({suggestionsHidden:!0}));break;case"ArrowDown":t.size>0&&!o&&(e.preventDefault(),this.setState({selectedSuggestion:Math.min(a+1,t.size-1)}));break;case"ArrowUp":t.size>0&&!o&&(e.preventDefault(),this.setState({selectedSuggestion:Math.max(a-1,0)}));break;case"Enter":case"Tab":null!==this.state.lastToken&&t.size>0&&!o&&(e.preventDefault(),e.stopPropagation(),this.props.onSuggestionSelected(this.state.tokenStart,this.state.lastToken,t.get(a)))}!e.defaultPrevented&&this.props.onKeyDown&&this.props.onKeyDown(e)}},this.onBlur=()=>{this.setState({suggestionsHidden:!0,focused:!1})},this.onFocus=()=>{this.setState({focused:!0})},this.onSuggestionClick=e=>{const t=this.props.suggestions.get(e.currentTarget.getAttribute("data-index"));e.preventDefault(),this.props.onSuggestionSelected(this.state.tokenStart,this.state.lastToken,t),this.input.focus()},this.setInput=e=>{this.input=e},this.renderSuggestion=(e,t)=>{const{selectedSuggestion:s}=this.state;let a,o;return"emoji"===e.type?(a=Object(n.a)(R,{emoji:e}),o=e.id):"hashtag"===e.type?(a=Object(n.a)(D,{tag:e}),o=e.name):"account"===e.type&&(a=Object(n.a)(M,{id:e.id}),o=e.id),Object(n.a)("div",{role:"button",tabIndex:"0","data-index":t,className:F()("autosuggest-textarea__suggestions__item",{selected:t===s}),onMouseDown:this.onSuggestionClick},o,a)}}componentWillReceiveProps(e){e.suggestions!==this.props.suggestions&&e.suggestions.size>0&&this.state.suggestionsHidden&&this.state.focused&&this.setState({suggestionsHidden:!1})}render(){const{value:e,suggestions:t,disabled:s,placeholder:a,onKeyUp:o,autoFocus:i,className:c,id:r,maxLength:d}=this.props,{suggestionsHidden:u}=this.state;return Object(n.a)("div",{className:"autosuggest-input"},void 0,Object(n.a)("label",{},void 0,Object(n.a)("span",{style:{display:"none"}},void 0,a),l.a.createElement("input",{type:"text",ref:this.setInput,disabled:s,placeholder:a,autoFocus:i,value:e,onChange:this.onChange,onKeyDown:this.onKeyDown,onKeyUp:o,onFocus:this.onFocus,onBlur:this.onBlur,dir:"auto","aria-autocomplete":"list",id:r,className:c,maxLength:d})),Object(n.a)("div",{className:"autosuggest-textarea__suggestions "+(u||t.isEmpty()?"":"autosuggest-textarea__suggestions--visible")},void 0,t.map(this.renderSuggestion)))}}var L;U.propTypes={value:h.a.string,suggestions:p.a.list,disabled:h.a.bool,placeholder:h.a.string,onSuggestionSelected:h.a.func.isRequired,onSuggestionsClearRequested:h.a.func.isRequired,onSuggestionsFetchRequested:h.a.func.isRequired,onChange:h.a.func.isRequired,onKeyUp:h.a.func,onKeyDown:h.a.func,autoFocus:h.a.bool,className:h.a.string,id:h.a.string,searchTokens:h.a.arrayOf(h.a.string),maxLength:h.a.number},U.defaultProps={autoFocus:!0,searchTokens:["@",":","#"]};const K=Object(j.f)({add_poll:{id:"poll_button.add_poll",defaultMessage:"Add a poll"},remove_poll:{id:"poll_button.remove_poll",defaultMessage:"Remove poll"}}),z={height:null,lineHeight:"27px"};let A=Object(j.g)(L=class extends l.a.PureComponent{constructor(){super(...arguments),this.handleClick=()=>{this.props.onClick()}}render(){const{intl:e,active:t,unavailable:s,disabled:a}=this.props;return s?null:Object(n.a)("div",{className:"compose-form__poll-button"},void 0,Object(n.a)(v.a,{icon:"tasks",title:e.formatMessage(t?K.remove_poll:K.add_poll),disabled:a,onClick:this.handleClick,className:"compose-form__poll-button-icon "+(t?"active":""),size:18,inverted:!0,style:z}))}})||L;var W,H,B=Object(i.connect)((e=>({unavailable:e.getIn(["compose","is_uploading"])||e.getIn(["compose","media_attachments"]).size>0,active:null!==e.getIn(["compose","poll"])})),(e=>({onClick(){e(((t,s)=>{s().getIn(["compose","poll"])?e(Object(m.sb)()):e(Object(m.U)())}))}})))(A);const Y=Object(j.f)({upload:{id:"upload_button.label",defaultMessage:"Add images, a video or an audio file"}}),V={height:null,lineHeight:"27px"};let X=Object(i.connect)((()=>e=>({acceptContentTypes:e.getIn(["media_attachments","accept_content_types"])})))(W=Object(j.g)(((H=class extends _.a{constructor(){super(...arguments),this.handleChange=e=>{e.target.files.length>0&&this.props.onSelectFile(e.target.files)},this.handleClick=()=>{this.fileElement.click()},this.setRef=e=>{this.fileElement=e}}render(){const{intl:e,resetFileKey:t,unavailable:s,disabled:a,acceptContentTypes:o}=this.props;if(s)return null;const i=e.formatMessage(Y.upload);return Object(n.a)("div",{className:"compose-form__upload-button"},void 0,Object(n.a)(v.a,{icon:"paperclip",title:i,disabled:a,onClick:this.handleClick,className:"compose-form__upload-button-icon",size:18,inverted:!0,style:V}),Object(n.a)("label",{},void 0,Object(n.a)("span",{style:{display:"none"}},void 0,i),l.a.createElement("input",{key:t,ref:this.setRef,type:"file",multiple:!0,accept:o.toArray().join(","),onChange:this.handleChange,disabled:a,style:{display:"none"}})))}}).propTypes={disabled:h.a.bool,unavailable:h.a.bool,onSelectFile:h.a.func.isRequired,style:h.a.object,resetFileKey:h.a.number,acceptContentTypes:p.a.listOf(h.a.string).isRequired,intl:h.a.object.isRequired},W=H))||W)||W;var $=Object(i.connect)((e=>({disabled:e.getIn(["compose","is_uploading"])||e.getIn(["compose","media_attachments"]).size+e.getIn(["compose","pending_media_attachments"])>3||e.getIn(["compose","media_attachments"]).some((e=>["video","audio"].includes(e.get("type")))),unavailable:null!==e.getIn(["compose","poll"]),resetFileKey:e.getIn(["compose","resetFileKey"])})),(e=>({onSelectFile(t){e(Object(m.Bb)(t))}})))(X);const Q={height:null,lineHeight:"27px",width:"23.14285722px"};class J extends l.a.PureComponent{render(){const{label:e,title:t,active:s,ariaControls:a}=this.props;return Object(n.a)("button",{title:t,"aria-label":t,className:"text-icon-button "+(s?"active":""),"aria-expanded":s,onClick:this.props.onClick,"aria-controls":a,style:Q},void 0,e)}}const Z=Object(j.f)({marked:{id:"compose_form.spoiler.marked",defaultMessage:"Text is hidden behind warning"},unmarked:{id:"compose_form.spoiler.unmarked",defaultMessage:"Text is not hidden"}});var G=Object(j.g)(Object(i.connect)(((e,t)=>{let{intl:s}=t;return{label:"CW",title:s.formatMessage(e.getIn(["compose","spoiler"])?Z.marked:Z.unmarked),active:e.getIn(["compose","spoiler"]),ariaControls:"cw-spoiler-input"}}),(e=>({onClick(){e(Object(m.bb)())}})))(J)),ee=s(366),te=s(35),se=s(103);var ae,oe,ie,ne=Object(i.connect)((e=>({value:e.getIn(["compose","privacy"])})),(e=>({onChange(t){e(Object(m.cb)(t))},isUserTouching:se.c,onModalOpen:t=>e(Object(te.d)("ACTIONS",t)),onModalClose:()=>e(Object(te.c)())})))(ee.a),ce=s(686),le=s(36),re=s(20);const de=Object(j.f)({option_placeholder:{id:"compose_form.poll.option_placeholder",defaultMessage:"Choice {number}"},add_option:{id:"compose_form.poll.add_option",defaultMessage:"Add a choice"},remove_option:{id:"compose_form.poll.remove_option",defaultMessage:"Remove this choice"},poll_duration:{id:"compose_form.poll.duration",defaultMessage:"Poll duration"},switchToMultiple:{id:"compose_form.poll.switch_to_multiple",defaultMessage:"Change poll to allow multiple choices"},switchToSingle:{id:"compose_form.poll.switch_to_single",defaultMessage:"Change poll to allow for a single choice"},minutes:{id:"intervals.full.minutes",defaultMessage:"{number, plural, one {# minute} other {# minutes}}"},hours:{id:"intervals.full.hours",defaultMessage:"{number, plural, one {# hour} other {# hours}}"},days:{id:"intervals.full.days",defaultMessage:"{number, plural, one {# day} other {# days}}"}});let ue=Object(j.g)(ae=class extends l.a.PureComponent{constructor(){super(...arguments),this.handleOptionTitleChange=e=>{this.props.onChange(this.props.index,e.target.value)},this.handleOptionRemove=()=>{this.props.onRemove(this.props.index)},this.handleToggleMultiple=e=>{this.props.onToggleMultiple(),e.preventDefault(),e.stopPropagation()},this.handleCheckboxKeypress=e=>{"Enter"!==e.key&&" "!==e.key||this.handleToggleMultiple(e)},this.onSuggestionsClearRequested=()=>{this.props.onClearSuggestions()},this.onSuggestionsFetchRequested=e=>{this.props.onFetchSuggestions(e)},this.onSuggestionSelected=(e,t,s)=>{this.props.onSuggestionSelected(e,t,s,["poll","options",this.props.index])}}render(){const{isPollMultiple:e,title:t,index:s,autoFocus:a,intl:o}=this.props;return Object(n.a)("li",{},void 0,Object(n.a)("label",{className:"poll__option editable"},void 0,Object(n.a)("span",{className:F()("poll__input",{checkbox:e}),onClick:this.handleToggleMultiple,onKeyPress:this.handleCheckboxKeypress,role:"button",tabIndex:"0",title:o.formatMessage(e?de.switchToSingle:de.switchToMultiple),"aria-label":o.formatMessage(e?de.switchToSingle:de.switchToMultiple)}),Object(n.a)(U,{placeholder:o.formatMessage(de.option_placeholder,{number:s+1}),maxLength:100,value:t,onChange:this.handleOptionTitleChange,suggestions:this.props.suggestions,onSuggestionsFetchRequested:this.onSuggestionsFetchRequested,onSuggestionsClearRequested:this.onSuggestionsClearRequested,onSuggestionSelected:this.onSuggestionSelected,searchTokens:[":"],autoFocus:a})),Object(n.a)("div",{className:"poll__cancel"},void 0,Object(n.a)(v.a,{disabled:s<=1,title:o.formatMessage(de.remove_option),icon:"times",onClick:this.handleOptionRemove})))}})||ae,pe=Object(j.g)(((ie=class extends _.a{constructor(){super(...arguments),this.handleAddOption=()=>{this.props.onAddOption("")},this.handleSelectDuration=e=>{this.props.onChangeSettings(e.target.value,this.props.isMultiple)},this.handleToggleMultiple=()=>{this.props.onChangeSettings(this.props.expiresIn,!this.props.isMultiple)}}render(){const{options:e,expiresIn:t,isMultiple:s,onChangeOption:a,onRemoveOption:o,intl:i,...c}=this.props;if(!e)return null;const r=e.indexOf("");return Object(n.a)("div",{className:"compose-form__poll-wrapper"},void 0,Object(n.a)("ul",{},void 0,e.map(((e,t)=>l.a.createElement(ue,Object(le.a)({title:e,key:t,index:t,onChange:a,onRemove:o,isPollMultiple:s,onToggleMultiple:this.handleToggleMultiple,autoFocus:t===r},c))))),Object(n.a)("div",{className:"poll__footer"},void 0,Object(n.a)("button",{disabled:e.size>=5,className:"button button-secondary",onClick:this.handleAddOption},void 0,Object(n.a)(re.a,{id:"plus"})," ",l.a.createElement(j.b,de.add_option)),Object(n.a)("select",{value:t,onChange:this.handleSelectDuration},void 0,Object(n.a)("option",{value:300},void 0,i.formatMessage(de.minutes,{number:5})),Object(n.a)("option",{value:1800},void 0,i.formatMessage(de.minutes,{number:30})),Object(n.a)("option",{value:3600},void 0,i.formatMessage(de.hours,{number:1})),Object(n.a)("option",{value:21600},void 0,i.formatMessage(de.hours,{number:6})),Object(n.a)("option",{value:86400},void 0,i.formatMessage(de.days,{number:1})),Object(n.a)("option",{value:259200},void 0,i.formatMessage(de.days,{number:3})),Object(n.a)("option",{value:604800},void 0,i.formatMessage(de.days,{number:7})))))}}).propTypes={options:p.a.list,expiresIn:h.a.number,isMultiple:h.a.bool,onChangeOption:h.a.func.isRequired,onAddOption:h.a.func.isRequired,onRemoveOption:h.a.func.isRequired,onChangeSettings:h.a.func.isRequired,suggestions:p.a.list,onClearSuggestions:h.a.func.isRequired,onFetchSuggestions:h.a.func.isRequired,onSuggestionSelected:h.a.func.isRequired,intl:h.a.object.isRequired},oe=ie))||oe;var ge=Object(i.connect)((e=>({suggestions:e.getIn(["compose","suggestions"]),options:e.getIn(["compose","poll","options"]),expiresIn:e.getIn(["compose","poll","expires_in"]),isMultiple:e.getIn(["compose","poll","multiple"])})),(e=>({onAddOption(t){e(Object(m.V)(t))},onRemoveOption(t){e(Object(m.tb)(t))},onChangeOption(t,s){e(Object(m.eb)(t,s))},onChangeSettings(t,s){e(Object(m.fb)(t,s))},onClearSuggestions(){e(Object(m.hb)())},onFetchSuggestions(t){e(Object(m.kb)(t))},onSuggestionSelected(t,s,a,o){e(Object(m.wb)(t,s,a,o))}})))(pe),he=s(367);var me=Object(i.connect)((e=>({active:e.getIn(["compose","is_uploading"]),progress:e.getIn(["compose","progress"])})))(he.a),be=s(78),fe=s(26),ve=s.n(fe);class Oe extends _.a{constructor(){super(...arguments),this.handleUndoClick=e=>{e.stopPropagation(),this.props.onUndo(this.props.media.get("id"))},this.handleFocalPointClick=e=>{e.stopPropagation(),this.props.onOpenFocalPoint(this.props.media.get("id"))}}render(){const{media:e,isEditingStatus:t}=this.props,s=e.getIn(["meta","focus","x"]),a=e.getIn(["meta","focus","y"]),o=100*(s/2+.5),i=100*(a/-2+.5);return Object(n.a)("div",{className:"compose-form__upload",tabIndex:"0",role:"button"},void 0,Object(n.a)(be.a,{defaultStyle:{scale:.8},style:{scale:ve()(1,{stiffness:180,damping:12})}},void 0,(s=>{let{scale:a}=s;return Object(n.a)("div",{className:"compose-form__upload-thumbnail",style:{transform:"scale("+a+")",backgroundImage:"url("+e.get("preview_url")+")",backgroundPosition:o+"% "+i+"%"}},void 0,Object(n.a)("div",{className:"compose-form__upload__actions"},void 0,Object(n.a)("button",{className:"icon-button",onClick:this.handleUndoClick},void 0,Object(n.a)(re.a,{id:"times"})," ",Object(n.a)(j.b,{id:"upload_form.undo",defaultMessage:"Delete"})),!t&&Object(n.a)("button",{className:"icon-button",onClick:this.handleFocalPointClick},void 0,Object(n.a)(re.a,{id:"pencil"})," ",Object(n.a)(j.b,{id:"upload_form.edit",defaultMessage:"Edit"}))),0===(e.get("description")||"").length&&Object(n.a)("div",{className:"compose-form__upload__warning"},void 0,Object(n.a)("button",{className:"icon-button",onClick:this.handleFocalPointClick},void 0,Object(n.a)(re.a,{id:"info-circle"})," ",Object(n.a)(j.b,{id:"upload_form.description_missing",defaultMessage:"No description added"}))))})))}}Oe.contextTypes={router:h.a.object},Oe.propTypes={media:p.a.map.isRequired,onUndo:h.a.func.isRequired,onOpenFocalPoint:h.a.func.isRequired,isEditingStatus:h.a.func.isRequired};var je=Object(i.connect)(((e,t)=>{let{id:s}=t;return{media:e.getIn(["compose","media_attachments"]).find((e=>e.get("id")===s)),isEditingStatus:null!==e.getIn(["compose","id"])}}),(e=>({onUndo:t=>{e(Object(m.zb)(t))},onOpenFocalPoint:t=>{e(Object(m.mb)(t))},onSubmit(t){e(Object(m.yb)(t))}})))(Oe);const _e=Object(j.f)({marked:{id:"compose_form.sensitive.marked",defaultMessage:"{count, plural, one {Media is marked as sensitive} other {Media is marked as sensitive}}"},unmarked:{id:"compose_form.sensitive.unmarked",defaultMessage:"{count, plural, one {Media is not marked as sensitive} other {Media is not marked as sensitive}}"}});class Se extends l.a.PureComponent{render(){const{active:e,disabled:t,mediaCount:s,onClick:a,intl:o}=this.props;return Object(n.a)("div",{className:"compose-form__sensitive-button"},void 0,Object(n.a)("label",{className:F()("icon-button",{active:e}),title:o.formatMessage(e?_e.marked:_e.unmarked,{count:s})},void 0,Object(n.a)("input",{name:"mark-sensitive",type:"checkbox",checked:e,onChange:a,disabled:t}),Object(n.a)("span",{className:F()("checkbox",{active:e})}),Object(n.a)(j.b,{id:"compose_form.sensitive.hide",defaultMessage:"{count, plural, one {Mark media as sensitive} other {Mark media as sensitive}}",values:{count:s}})))}}var Ce=Object(i.connect)((e=>({active:e.getIn(["compose","sensitive"]),disabled:e.getIn(["compose","spoiler"]),mediaCount:e.getIn(["compose","media_attachments"]).size})),(e=>({onClick(){e(Object(m.Z)())}})))(Object(j.g)(Se));class ye extends _.a{render(){const{mediaIds:e}=this.props;return Object(n.a)("div",{className:"compose-form__upload-wrapper"},void 0,Object(n.a)(me,{icon:"upload",message:Object(n.a)(j.b,{id:"upload_progress.label",defaultMessage:"Uploading…"})}),Object(n.a)("div",{className:"compose-form__uploads-wrapper"},void 0,e.map((e=>Object(n.a)(je,{id:e},e)))),!e.isEmpty()&&Object(n.a)(Ce,{}))}}ye.propTypes={mediaIds:p.a.list.isRequired};var xe=Object(i.connect)((e=>({mediaIds:e.getIn(["compose","media_attachments"]).map((e=>e.get("id")))})))(ye);class ke extends l.a.PureComponent{render(){const{message:e}=this.props;return Object(n.a)(be.a,{defaultStyle:{opacity:0,scaleX:.85,scaleY:.75},style:{opacity:ve()(1,{damping:35,stiffness:400}),scaleX:ve()(1,{damping:35,stiffness:400}),scaleY:ve()(1,{damping:35,stiffness:400})}},void 0,(t=>{let{opacity:s,scaleX:a,scaleY:o}=t;return Object(n.a)("div",{className:"compose-form__warning",style:{opacity:s,transform:"scale("+a+", "+o+")"}},void 0,e)}))}}var Me=s(11);const we=(()=>{try{const e="_\\u00b7\\u200c",t="\\p{L}\\p{M}",s="\\p{L}\\p{M}\\p{N}\\p{Pc}";return new RegExp("(?:^|[^\\/\\)\\w])#((["+s+"_]["+s+e+"]*["+t+e+"]["+s+e+"]*["+s+"_])|(["+s+"_]*["+t+"]["+s+"_]*))","iu")}catch{return/(?:^|[^\/\)\w])#(\w*[a-zA-Z·]\w*)/i}})();var Ne,Te=Object(i.connect)((e=>({needsLockWarning:"private"===e.getIn(["compose","privacy"])&&!e.getIn(["accounts",Me.n,"locked"]),hashtagWarning:"public"!==e.getIn(["compose","privacy"])&&we.test(e.getIn(["compose","text"])),directMessageWarning:"direct"===e.getIn(["compose","privacy"])})))((e=>{let{needsLockWarning:t,hashtagWarning:s,directMessageWarning:a}=e;if(t)return Object(n.a)(ke,{message:Object(n.a)(j.b,{id:"compose_form.lock_disclaimer",defaultMessage:"Your account is not {locked}. Anyone can follow you to view your follower-only posts.",values:{locked:Object(n.a)("a",{href:"/settings/profile"},void 0,Object(n.a)(j.b,{id:"compose_form.lock_disclaimer.lock",defaultMessage:"locked"}))}})});if(s)return Object(n.a)(ke,{message:Object(n.a)(j.b,{id:"compose_form.hashtag_warning",defaultMessage:"This post won't be listed under any hashtag as it is unlisted. Only public posts can be searched by hashtag."})});if(a){const e=Object(n.a)("span",{},void 0,Object(n.a)(j.b,{id:"compose_form.encryption_warning",defaultMessage:"Posts on Mastodon are not end-to-end encrypted. Do not share any dangerous information over Mastodon."})," ",Object(n.a)("a",{href:"/terms",target:"_blank"},void 0,Object(n.a)(j.b,{id:"compose_form.direct_message_warning_learn_more",defaultMessage:"Learn more"})));return Object(n.a)(ke,{message:e})}return null})),Re=s(94),Ie=s.n(Re),De=s(251),qe=s(580),Pe=s.n(qe);const Fe=Object(j.f)({changeLanguage:{id:"compose.language.change",defaultMessage:"Change language"},search:{id:"compose.language.search",defaultMessage:"Search languages..."},clear:{id:"emoji_button.clear",defaultMessage:"Clear"}}),Ee={loupe:Object(n.a)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",width:"13",height:"13"},void 0,Object(n.a)("path",{d:"M12.9 14.32a8 8 0 1 1 1.41-1.41l5.35 5.33-1.42 1.42-5.33-5.34zM8 14A6 6 0 1 0 8 2a6 6 0 0 0 0 12z"})),delete:Object(n.a)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",width:"13",height:"13"},void 0,Object(n.a)("path",{d:"M10 8.586L2.929 1.515 1.515 2.929 8.586 10l-7.071 7.071 1.414 1.414L10 11.414l7.071 7.071 1.414-1.414L11.414 10l7.071-7.071-1.414-1.414L10 8.586z"}))},Ue=!!De.a&&{passive:!0};class Le extends l.a.PureComponent{constructor(){super(...arguments),this.state={mounted:!1,searchValue:""},this.handleDocumentClick=e=>{this.node&&!this.node.contains(e.target)&&this.props.onClose()},this.setRef=e=>{this.node=e},this.setListRef=e=>{this.listNode=e},this.handleSearchChange=e=>{let{target:t}=e;this.setState({searchValue:t.value})},this.handleClick=e=>{const t=e.currentTarget.getAttribute("data-index");e.preventDefault(),this.props.onClose(),this.props.onChange(t)},this.handleKeyDown=e=>{const{onClose:t}=this.props,s=Array.from(this.listNode.childNodes).findIndex((t=>t===e.currentTarget));let a=null;switch(e.key){case"Escape":t();break;case"Enter":this.handleClick(e);break;case"ArrowDown":a=this.listNode.childNodes[s+1]||this.listNode.firstChild;break;case"ArrowUp":a=this.listNode.childNodes[s-1]||this.listNode.lastChild;break;case"Tab":a=e.shiftKey?this.listNode.childNodes[s-1]||this.listNode.lastChild:this.listNode.childNodes[s+1]||this.listNode.firstChild;break;case"Home":a=this.listNode.firstChild;break;case"End":a=this.listNode.lastChild}a&&(a.focus(),e.preventDefault(),e.stopPropagation())},this.handleSearchKeyDown=e=>{const{onChange:t,onClose:s}=this.props,{searchValue:a}=this.state;let o=null;switch(e.key){case"Tab":case"ArrowDown":o=this.listNode.firstChild,o&&(o.focus(),e.preventDefault(),e.stopPropagation());break;case"Enter":o=this.listNode.firstChild,o&&(t(o.getAttribute("data-index")),s());break;case"Escape":""!==a&&(e.preventDefault(),this.handleClear())}},this.handleClear=()=>{this.setState({searchValue:""})},this.renderItem=e=>{const{value:t}=this.props;return Object(n.a)("div",{role:"option",tabIndex:"0","data-index":e[0],className:F()("language-dropdown__dropdown__results__item",{active:e[0]===t}),"aria-selected":e[0]===t,onClick:this.handleClick,onKeyDown:this.handleKeyDown},e[0],Object(n.a)("span",{className:"language-dropdown__dropdown__results__item__native-name"},void 0,e[2])," ",Object(n.a)("span",{className:"language-dropdown__dropdown__results__item__common-name"},void 0,"(",e[1],")"))}}componentDidMount(){document.addEventListener("click",this.handleDocumentClick,!1),document.addEventListener("touchend",this.handleDocumentClick,Ue),this.setState({mounted:!0})}componentWillUnmount(){document.removeEventListener("click",this.handleDocumentClick,!1),document.removeEventListener("touchend",this.handleDocumentClick,Ue)}search(){const{languages:e,value:t,frequentlyUsedLanguages:s}=this.props,{searchValue:a}=this.state;return""===a?[...e].sort(((e,a)=>{if(e[0]===t)return-1;if(a[0]===t)return 1;{const t=s.indexOf(e[0]),o=s.indexOf(a[0]);return(t>-1?t:1/0)-(o>-1?o:1/0)}})):Pe.a.go(a,e,{keys:["0","1","2"],limit:5,threshold:-1e4}).map((e=>e.obj))}frequentlyUsed(){const{languages:e,value:t}=this.props,s=e.find((e=>e[0]===t)),a=[];return s&&a.push(s),a}render(){const{style:e,placement:t,intl:s}=this.props,{mounted:a,searchValue:o}=this.state,i=""!==o,c=this.search();return Object(n.a)(be.a,{defaultStyle:{opacity:0,scaleX:.85,scaleY:.75},style:{opacity:ve()(1,{damping:35,stiffness:400}),scaleX:ve()(1,{damping:35,stiffness:400}),scaleY:ve()(1,{damping:35,stiffness:400})}},void 0,(r=>{let{opacity:d,scaleX:u,scaleY:p}=r;return l.a.createElement("div",{className:"language-dropdown__dropdown "+t,style:{...e,opacity:d,transform:a?"scale("+u+", "+p+")":null},ref:this.setRef},Object(n.a)("div",{className:"emoji-mart-search"},void 0,Object(n.a)("input",{type:"search",value:o,onChange:this.handleSearchChange,onKeyDown:this.handleSearchKeyDown,placeholder:s.formatMessage(Fe.search),autoFocus:!0}),Object(n.a)("button",{className:"emoji-mart-search-icon",disabled:!i,"aria-label":s.formatMessage(Fe.clear),onClick:this.handleClear},void 0,i?Ee.delete:Ee.loupe)),l.a.createElement("div",{className:"language-dropdown__dropdown__results emoji-mart-scroll",role:"listbox",ref:this.setListRef},c.map(this.renderItem)))}))}}Le.defaultProps={languages:Me.j};let Ke=Object(j.g)(Ne=class extends l.a.PureComponent{constructor(){super(...arguments),this.state={open:!1,placement:"bottom"},this.handleToggle=e=>{let{target:t}=e;const{top:s}=t.getBoundingClientRect();this.state.open&&this.activeElement&&this.activeElement.focus({preventScroll:!0}),this.setState({placement:2*s<innerHeight?"bottom":"top"}),this.setState({open:!this.state.open})},this.handleClose=()=>{const{value:e,onClose:t}=this.props;this.state.open&&this.activeElement&&this.activeElement.focus({preventScroll:!0}),this.setState({open:!1}),t(e)},this.handleChange=e=>{const{onChange:t}=this.props;t(e)}}render(){const{value:e,intl:t,frequentlyUsedLanguages:s}=this.props,{open:a,placement:o}=this.state;return Object(n.a)("div",{className:F()("privacy-dropdown",{active:a})},void 0,Object(n.a)("div",{className:"privacy-dropdown__value"},void 0,Object(n.a)(J,{className:"privacy-dropdown__value-icon",label:e&&e.toUpperCase(),title:t.formatMessage(Fe.changeLanguage),active:a,onClick:this.handleToggle})),Object(n.a)(Ie.a,{show:a,placement:o,target:this},void 0,Object(n.a)(Le,{value:e,frequentlyUsedLanguages:s,onClose:this.handleClose,onChange:this.handleChange,placement:o,intl:t})))}})||Ne;var ze=s(364),Ae=s(39),We=s(2);const He=Object(Ae.a)([e=>e.getIn(["settings","frequentlyUsedLanguages"],Object(We.Map)())],(e=>e.keySeq().sort(((t,s)=>e.get(t)-e.get(s))).reverse().toArray()));var Be=Object(i.connect)((e=>({frequentlyUsedLanguages:He(e),value:e.getIn(["compose","language"])})),(e=>({onChange(t){e(Object(m.Y)(t))},onClose(t){e(Object(ze.b)(t))}})))(Ke),Ye=s(88),Ve=s(74),Xe=s.n(Ve),$e=s(574),Qe=s.n($e),Je=s(575),Ze=s.n(Je),Ge=s(576),et=s.n(Ge),tt=s(577),st=s.n(tt),at=s(578),ot=s.n(at),it=s(579),nt=s.n(it);const ct=Xe()("((#{validUrlPrecedingChars})(https?:\\/\\/)(#{validDomain})(?::(#{validPortNumber}))?(\\/#{validUrlPath}*)?(\\?#{validUrlQueryChars}*#{validUrlQueryEndingChars})?)",{validUrlPrecedingChars:Qe.a,validDomain:Ze.a,validPortNumber:et.a,validUrlPath:st.a,validUrlQueryChars:ot.a,validUrlQueryEndingChars:nt.a},"gi");var lt,rt;const dt=Object(j.f)({placeholder:{id:"compose_form.placeholder",defaultMessage:"What is on your mind?"},spoiler_placeholder:{id:"compose_form.spoiler_placeholder",defaultMessage:"Write your warning here"},publish:{id:"compose_form.publish",defaultMessage:"Publish"},publishLoud:{id:"compose_form.publish_loud",defaultMessage:"{publish}!"},saveChanges:{id:"compose_form.save_changes",defaultMessage:"Save changes"}});let ut=Object(j.g)(((rt=class extends _.a{constructor(){super(...arguments),this.handleChange=e=>{this.props.onChange(e.target.value)},this.handleKeyDown=e=>{13===e.keyCode&&(e.ctrlKey||e.metaKey)&&this.handleSubmit()},this.getFulltextForCharacterCounting=()=>{return[this.props.spoiler?this.props.spoilerText:"",(e=this.props.text,e.replace(ct,"$2xxxxxxxxxxxxxxxxxxxxxxx").replace(/(^|[^\/\w])@(([a-z0-9_]+)@[a-z0-9\.\-]+[a-z0-9]+)/gi,"$1@$3"))].join("");var e},this.canSubmit=()=>{const{isSubmitting:e,isChangingUpload:t,isUploading:s,anyMedia:a}=this.props,o=this.getFulltextForCharacterCounting(),i=0!==o.length&&0===o.trim().length;return!(e||s||t||Object(Ye.length)(o)>Me.m||i&&!a)},this.handleSubmit=()=>{this.props.text!==this.autosuggestTextarea.textarea.value&&this.props.onChange(this.autosuggestTextarea.textarea.value),this.canSubmit()&&this.props.onSubmit(this.context.router?this.context.router.history:null)},this.onSuggestionsClearRequested=()=>{this.props.onClearSuggestions()},this.onSuggestionsFetchRequested=e=>{this.props.onFetchSuggestions(e)},this.onSuggestionSelected=(e,t,s)=>{this.props.onSuggestionSelected(e,t,s,["text"])},this.onSpoilerSuggestionSelected=(e,t,s)=>{this.props.onSuggestionSelected(e,t,s,["spoiler_text"])},this.handleChangeSpoilerText=e=>{this.props.onChangeSpoilerText(e.target.value)},this.handleFocus=()=>{if(this.composeForm&&!this.props.singleColumn){const{left:e,right:t}=this.composeForm.getBoundingClientRect();(e<0||t>(window.innerWidth||document.documentElement.clientWidth))&&this.composeForm.scrollIntoView()}},this._updateFocusAndSelection=e=>{if(this.props.focusDate!==e.focusDate){let t,s;this.props.preselectDate!==e.preselectDate&&this.props.isInReply?(t=this.props.text.length,s=this.props.text.search(/\s/)+1):"number"==typeof this.props.caretPosition?(s=this.props.caretPosition,t=this.props.caretPosition):(t=this.props.text.length,s=t),Promise.resolve().then((()=>{this.autosuggestTextarea.textarea.setSelectionRange(s,t),this.autosuggestTextarea.textarea.focus()})).catch(console.error)}else e.isSubmitting&&!this.props.isSubmitting?this.autosuggestTextarea.textarea.focus():this.props.spoiler!==e.spoiler&&(this.props.spoiler?this.spoilerText.input.focus():this.autosuggestTextarea.textarea.focus())},this.setAutosuggestTextarea=e=>{this.autosuggestTextarea=e},this.setSpoilerText=e=>{this.spoilerText=e},this.setRef=e=>{this.composeForm=e},this.handleEmojiPick=e=>{const{text:t}=this.props,s=this.autosuggestTextarea.textarea.selectionStart,a=e.custom&&s>0&&!"><                　\u2028\u2029\t\n\v\f\r".includes(t[s-1]);this.props.onPickEmoji(s,e,a)}}componentDidMount(){this._updateFocusAndSelection({})}componentDidUpdate(e){this._updateFocusAndSelection(e)}render(){const{intl:e,onPaste:t,showSearch:s}=this.props,a=this.props.isSubmitting;let o="";return o=this.props.isEditing?e.formatMessage(dt.saveChanges):"private"===this.props.privacy||"direct"===this.props.privacy?Object(n.a)("span",{className:"compose-form__publish-private"},void 0,Object(n.a)(re.a,{id:"lock"})," ",e.formatMessage(dt.publish)):"unlisted"!==this.props.privacy?e.formatMessage(dt.publishLoud,{publish:e.formatMessage(dt.publish)}):e.formatMessage(dt.publish),Object(n.a)("div",{className:"compose-form"},void 0,Object(n.a)(Te,{}),Object(n.a)(x,{}),l.a.createElement("div",{className:"spoiler-input "+(this.props.spoiler?"spoiler-input--visible":""),ref:this.setRef},l.a.createElement(U,{placeholder:e.formatMessage(dt.spoiler_placeholder),value:this.props.spoilerText,onChange:this.handleChangeSpoilerText,onKeyDown:this.handleKeyDown,disabled:!this.props.spoiler,ref:this.setSpoilerText,suggestions:this.props.suggestions,onSuggestionsFetchRequested:this.onSuggestionsFetchRequested,onSuggestionsClearRequested:this.onSuggestionsClearRequested,onSuggestionSelected:this.onSpoilerSuggestionSelected,searchTokens:[":"],id:"cw-spoiler-input",className:"spoiler-input__input"})),l.a.createElement(E,{ref:this.setAutosuggestTextarea,placeholder:e.formatMessage(dt.placeholder),disabled:a,value:this.props.text,onChange:this.handleChange,suggestions:this.props.suggestions,onFocus:this.handleFocus,onKeyDown:this.handleKeyDown,onSuggestionsFetchRequested:this.onSuggestionsFetchRequested,onSuggestionsClearRequested:this.onSuggestionsClearRequested,onSuggestionSelected:this.onSuggestionSelected,onPaste:t,autoFocus:!s&&!Object(se.b)(window.innerWidth)},Object(n.a)(ce.a,{onPickEmoji:this.handleEmojiPick}),Object(n.a)("div",{className:"compose-form__modifiers"},void 0,Object(n.a)(xe,{}),Object(n.a)(ge,{}))),Object(n.a)("div",{className:"compose-form__buttons-wrapper"},void 0,Object(n.a)("div",{className:"compose-form__buttons"},void 0,Object(n.a)($,{}),Object(n.a)(B,{}),Object(n.a)(ne,{disabled:this.props.isEditing}),Object(n.a)(G,{}),Object(n.a)(Be,{})),Object(n.a)("div",{className:"character-counter__wrapper"},void 0,Object(n.a)(r.a,{max:Me.m,text:this.getFulltextForCharacterCounting()}))),Object(n.a)("div",{className:"compose-form__publish"},void 0,Object(n.a)("div",{className:"compose-form__publish-button-wrapper"},void 0,Object(n.a)(d.a,{text:o,onClick:this.handleSubmit,disabled:!this.canSubmit(),block:!0}))))}}).contextTypes={router:h.a.object},rt.propTypes={intl:h.a.object.isRequired,text:h.a.string.isRequired,suggestions:p.a.list,spoiler:h.a.bool,privacy:h.a.string,spoilerText:h.a.string,focusDate:h.a.instanceOf(Date),caretPosition:h.a.number,preselectDate:h.a.instanceOf(Date),isSubmitting:h.a.bool,isChangingUpload:h.a.bool,isEditing:h.a.bool,isUploading:h.a.bool,onChange:h.a.func.isRequired,onSubmit:h.a.func.isRequired,onClearSuggestions:h.a.func.isRequired,onFetchSuggestions:h.a.func.isRequired,onSuggestionSelected:h.a.func.isRequired,onChangeSpoilerText:h.a.func.isRequired,onPaste:h.a.func.isRequired,onPickEmoji:h.a.func.isRequired,showSearch:h.a.bool,anyMedia:h.a.bool,isInReply:h.a.bool,singleColumn:h.a.bool},rt.defaultProps={showSearch:!1},lt=rt))||lt;t.a=Object(i.connect)((e=>({text:e.getIn(["compose","text"]),suggestions:e.getIn(["compose","suggestions"]),spoiler:e.getIn(["compose","spoiler"]),spoilerText:e.getIn(["compose","spoiler_text"]),privacy:e.getIn(["compose","privacy"]),focusDate:e.getIn(["compose","focusDate"]),caretPosition:e.getIn(["compose","caretPosition"]),preselectDate:e.getIn(["compose","preselectDate"]),isSubmitting:e.getIn(["compose","is_submitting"]),isEditing:null!==e.getIn(["compose","id"]),isChangingUpload:e.getIn(["compose","is_changing_upload"]),isUploading:e.getIn(["compose","is_uploading"]),showSearch:e.getIn(["search","submitted"])&&!e.getIn(["search","hidden"]),anyMedia:e.getIn(["compose","media_attachments"]).size>0,isInReply:null!==e.getIn(["compose","in_reply_to"])})),(e=>({onChange(t){e(Object(m.X)(t))},onSubmit(t){e(Object(m.yb)(t))},onClearSuggestions(){e(Object(m.hb)())},onFetchSuggestions(t){e(Object(m.kb)(t))},onSuggestionSelected(t,s,a,o){e(Object(m.wb)(t,s,a,o))},onChangeSpoilerText(t){e(Object(m.ab)(t))},onPaste(t){e(Object(m.Bb)(t))},onPickEmoji(t,s,a){e(Object(m.nb)(t,s,a))}})))(ut)}}]);
//# sourceMappingURL=compose-2f4de33672bcdf556156.chunk.js.map