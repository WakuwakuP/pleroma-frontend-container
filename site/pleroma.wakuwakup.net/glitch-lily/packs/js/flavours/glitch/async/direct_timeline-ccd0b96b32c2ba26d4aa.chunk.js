(window.webpackJsonp=window.webpackJsonp||[]).push([[70],{1119:function(e,t,s){"use strict";s.r(t),s.d(t,"default",(function(){return se}));var o,a=s(0),n=s(1),i=s.n(n),r=s(12),c=s(1316),d=s(1302),l=s(1294),h=s(41),u=s(261),p=s(373),m=s(4),g=s(1315),v=s(1362);const b=Object(m.f)({filter_regex:{id:"home.column_settings.filter_regex",defaultMessage:"Filter out by regular expressions"},settings:{id:"home.settings",defaultMessage:"Column settings"}});let M=Object(m.g)(o=class extends i.a.PureComponent{render(){const{settings:e,onChange:t,intl:s}=this.props;return Object(a.a)("div",{},void 0,Object(a.a)("span",{className:"column-settings__section"},void 0,Object(a.a)(m.b,{id:"home.column_settings.basic",defaultMessage:"Basic"})),Object(a.a)("div",{className:"column-settings__row"},void 0,Object(a.a)(g.a,{settings:e,settingPath:["conversations"],onChange:t,label:Object(a.a)(m.b,{id:"direct.group_by_conversations",defaultMessage:"Group by conversation"})})),Object(a.a)("span",{className:"column-settings__section"},void 0,Object(a.a)(m.b,{id:"home.column_settings.advanced",defaultMessage:"Advanced"})),Object(a.a)("div",{className:"column-settings__row"},void 0,Object(a.a)(v.a,{settings:e,settingPath:["regex","body"],onChange:t,label:s.formatMessage(b.filter_regex)})))}})||o;var f=s(83);var j,O,_=Object(r.connect)((e=>({settings:e.getIn(["settings","direct"])})),(e=>({onChange(t,s){e(Object(f.c)(["direct",...t],s))}})))(M),y=s(1318),k=s(36),w=s(29),C=s.n(w),x=s(3),I=s.n(x),R=s(16),L=s.n(R),S=s(18),D=s(287),N=s(353),T=s(1324),q=s(1413),E=s(468),H=s(45),U=s(139),A=s(616),K=s(14),P=s(7),W=s.n(P);const z=Object(m.f)({more:{id:"status.more",defaultMessage:"More"},open:{id:"conversation.open",defaultMessage:"View conversation"},reply:{id:"status.reply",defaultMessage:"Reply"},markAsRead:{id:"conversation.mark_as_read",defaultMessage:"Mark as read"},delete:{id:"conversation.delete",defaultMessage:"Delete conversation"},muteConversation:{id:"status.mute_conversation",defaultMessage:"Mute conversation"},unmuteConversation:{id:"status.unmute_conversation",defaultMessage:"Unmute conversation"}});let B=Object(m.g)(((O=class extends S.a{constructor(){super(...arguments),this.state={isExpanded:void 0},this.parseClick=(e,t)=>{const{router:s}=this.context,{lastStatus:o,unread:a,markRead:n}=this.props;if(s&&0===e.button&&!(e.ctrlKey||e.altKey||e.metaKey)){void 0===t&&(a&&n(),t="/statuses/"+o.get("id"));let i={...s.history.location.state};i.mastodonBackSteps=(i.mastodonBackSteps||0)+1,s.history.push(t,i),e.preventDefault()}},this.handleMouseEnter=e=>{let{currentTarget:t}=e;if(K.autoPlayGif)return;const s=t.querySelectorAll(".custom-emoji");for(var o=0;o<s.length;o++){let e=s[o];e.src=e.getAttribute("data-original")}},this.handleMouseLeave=e=>{let{currentTarget:t}=e;if(K.autoPlayGif)return;const s=t.querySelectorAll(".custom-emoji");for(var o=0;o<s.length;o++){let e=s[o];e.src=e.getAttribute("data-static")}},this.handleClick=()=>{if(!this.context.router)return;const{lastStatus:e,unread:t,markRead:s}=this.props;t&&s(),this.context.router.history.push("/@"+e.getIn(["account","acct"])+"/"+e.get("id"))},this.handleMarkAsRead=()=>{this.props.markRead()},this.handleReply=()=>{this.props.reply(this.props.lastStatus,this.context.router.history)},this.handleDelete=()=>{this.props.delete()},this.handleHotkeyMoveUp=()=>{this.props.onMoveUp(this.props.conversationId)},this.handleHotkeyMoveDown=()=>{this.props.onMoveDown(this.props.conversationId)},this.handleConversationMute=()=>{this.props.onMute(this.props.lastStatus)},this.handleShowMore=()=>{this.props.onToggleHidden(this.props.lastStatus),this.props.lastStatus.get("spoiler_text")&&this.setExpansion(!this.state.isExpanded)},this.setExpansion=e=>{this.setState({isExpanded:e})}}render(){const{accounts:e,lastStatus:t,unread:s,scrollKey:o,intl:n}=this.props;if(null===t)return null;const i=this.props.settings.getIn(["content_warnings","shared_state"])?!t.get("hidden"):this.state.isExpanded,r=[{text:n.formatMessage(z.open),action:this.handleClick},null];r.push({text:n.formatMessage(t.get("muted")?z.unmuteConversation:z.muteConversation),action:this.handleConversationMute}),s&&(r.push({text:n.formatMessage(z.markAsRead),action:this.handleMarkAsRead}),r.push(null)),r.push({text:n.formatMessage(z.delete),action:this.handleDelete});const c=e.map((e=>Object(a.a)(E.a,{to:"/@"+e.get("acct"),href:e.get("url"),title:e.get("acct")},e.get("id"),Object(a.a)("bdi",{},void 0,Object(a.a)("strong",{className:"display-name__html",dangerouslySetInnerHTML:{__html:e.get("display_name_html")}}))))).reduce(((e,t)=>[e,", ",t])),d={reply:this.handleReply,open:this.handleClick,moveUp:this.handleHotkeyMoveUp,moveDown:this.handleHotkeyMoveDown,toggleHidden:this.handleShowMore};let l=null;return t.get("media_attachments").size>0&&(l=Object(a.a)(N.a,{compact:!0,media:t.get("media_attachments")})),Object(a.a)(A.HotKeys,{handlers:d},void 0,Object(a.a)("div",{className:W()("conversation focusable muted",{"conversation--unread":s}),tabIndex:"0"},void 0,Object(a.a)("div",{className:"conversation__avatar",onClick:this.handleClick,role:"presentation"},void 0,Object(a.a)(q.a,{accounts:e,size:48})),Object(a.a)("div",{className:"conversation__content"},void 0,Object(a.a)("div",{className:"conversation__content__info"},void 0,Object(a.a)("div",{className:"conversation__content__relative-time"},void 0,s&&Object(a.a)("span",{className:"conversation__unread"})," ",Object(a.a)(U.default,{timestamp:t.get("created_at")})),Object(a.a)("div",{className:"conversation__content__names",onMouseEnter:this.handleMouseEnter,onMouseLeave:this.handleMouseLeave},void 0,Object(a.a)(m.b,{id:"conversation.with",defaultMessage:"With {names}",values:{names:Object(a.a)("span",{},void 0,c)}}))),Object(a.a)(D.a,{status:t,parseClick:this.parseClick,expanded:i,onExpandedToggle:this.handleShowMore,collapsable:!0,media:l}),Object(a.a)("div",{className:"status__action-bar"},void 0,Object(a.a)(H.a,{className:"status__action-bar-button",title:n.formatMessage(z.reply),icon:"reply",onClick:this.handleReply}),Object(a.a)("div",{className:"status__action-bar-dropdown"},void 0,Object(a.a)(T.a,{scrollKey:o,status:t,items:r,icon:"ellipsis-h",size:18,direction:"right",title:n.formatMessage(z.more)}))))))}}).contextTypes={router:I.a.object},O.propTypes={conversationId:I.a.string.isRequired,accounts:L.a.list.isRequired,lastStatus:L.a.map,unread:I.a.bool.isRequired,scrollKey:I.a.string,onMoveUp:I.a.func,onMoveDown:I.a.func,markRead:I.a.func.isRequired,delete:I.a.func.isRequired,intl:I.a.object.isRequired},j=O))||j;var G=s(143),V=s(17),F=s(51),J=s(204);const Y=Object(m.f)({replyConfirm:{id:"confirmations.reply.confirm",defaultMessage:"Reply"},replyMessage:{id:"confirmations.reply.message",defaultMessage:"Replying now will overwrite the message you are currently composing. Are you sure you want to proceed?"}});var Q=Object(m.g)(Object(r.connect)((()=>{const e=Object(G.h)();return(t,s)=>{let{conversationId:o}=s;const a=t.getIn(["conversations","items"]).find((e=>e.get("id")===o)),n=a.get("last_status",null);return{accounts:a.get("accounts").map((e=>t.getIn(["accounts",e],null))),unread:a.get("unread"),lastStatus:n&&e(t,{id:n}),settings:t.get("local_settings")}}}),((e,t)=>{let{intl:s,conversationId:o}=t;return{markRead(){e(Object(u.k)(o))},reply(t,o){e(((a,n)=>{0!==n().getIn(["compose","text"]).trim().length?e(Object(F.d)("CONFIRM",{message:s.formatMessage(Y.replyMessage),confirm:s.formatMessage(Y.replyConfirm),onConfirm:()=>e(Object(V.Ab)(t,o))})):e(Object(V.Ab)(t,o))}))},delete(){e(Object(u.i)(o))},onMute(t){t.get("muted")?e(Object(J.n)(t.get("id"))):e(Object(J.l)(t.get("id")))},onToggleHidden(t){t.get("hidden")?e(Object(J.m)(t.get("id"))):e(Object(J.k)(t.get("id")))}}}))(B)),X=s(1295);class Z extends S.a{constructor(){super(...arguments),this.getCurrentIndex=e=>this.props.conversations.findIndex((t=>t.get("id")===e)),this.handleMoveUp=e=>{const t=this.getCurrentIndex(e)-1;this._selectChild(t,!0)},this.handleMoveDown=e=>{const t=this.getCurrentIndex(e)+1;this._selectChild(t,!1)},this.setRef=e=>{this.node=e},this.handleLoadOlder=C()((()=>{const e=this.props.conversations.last();e&&e.get("last_status")&&this.props.onLoadMore(e.get("last_status"))}),300,{leading:!0})}_selectChild(e,t){const s=this.node.node,o=s.querySelector("article:nth-of-type("+(e+1)+") .focusable");o&&(t&&s.scrollTop>o.offsetTop?o.scrollIntoView(!0):!t&&s.scrollTop+s.clientHeight<o.offsetTop+o.offsetHeight&&o.scrollIntoView(!1),o.focus())}render(){const{conversations:e,onLoadMore:t,...s}=this.props;return i.a.createElement(X.a,Object(k.a)({},s,{onLoadMore:t&&this.handleLoadOlder,ref:this.setRef}),e.map((e=>Object(a.a)(Q,{conversationId:e.get("id"),onMoveUp:this.handleMoveUp,onMoveDown:this.handleMoveDown,scrollKey:this.props.scrollKey},e.get("id")))))}}Z.propTypes={conversations:L.a.list.isRequired,scrollKey:I.a.string.isRequired,hasMore:I.a.bool,isLoading:I.a.bool,onLoadMore:I.a.func};var $,ee=Object(r.connect)((e=>({conversations:e.getIn(["conversations","items"]),isLoading:e.getIn(["conversations","isLoading"],!0),hasMore:e.getIn(["conversations","hasMore"],!1)})),(e=>({onLoadMore:t=>e(Object(u.j)({maxId:t}))})))(Z);const te=Object(m.f)({title:{id:"column.direct",defaultMessage:"Direct messages"}});let se=Object(r.connect)((e=>({hasUnread:e.getIn(["timelines","direct","unread"])>0,conversationsMode:e.getIn(["settings","direct","conversations"])})))($=Object(m.g)($=class extends i.a.PureComponent{constructor(){super(...arguments),this.handlePin=()=>{const{columnId:e,dispatch:t}=this.props;t(e?Object(p.h)(e):Object(p.e)("DIRECT",{}))},this.handleMove=e=>{const{columnId:t,dispatch:s}=this.props;s(Object(p.g)(t,e))},this.handleHeaderClick=()=>{this.column.scrollTop()},this.setRef=e=>{this.column=e},this.handleLoadMoreTimeline=e=>{this.props.dispatch(Object(h.t)({maxId:e}))},this.handleLoadMoreConversations=e=>{this.props.dispatch(Object(u.j)({maxId:e}))}}componentDidMount(){const{dispatch:e,conversationsMode:t}=this.props;e(Object(u.l)()),e(t?Object(u.j)():Object(h.t)()),this.disconnect=e(Object(y.b)())}componentDidUpdate(e){const{dispatch:t,conversationsMode:s}=this.props;e.conversationsMode&&!s?t(Object(h.t)()):!e.conversationsMode&&s&&t(Object(u.j)())}componentWillUnmount(){this.props.dispatch(Object(u.m)()),this.disconnect&&(this.disconnect(),this.disconnect=null)}render(){const{intl:e,hasUnread:t,columnId:s,multiColumn:o,conversationsMode:n}=this.props,r=!!s;let h;return h=n?Object(a.a)(ee,{trackScroll:!r,scrollKey:"direct_timeline-"+s,timelineId:"direct",onLoadMore:this.handleLoadMore,prepend:Object(a.a)("div",{className:"follow_requests-unlocked_explanation"},void 0,Object(a.a)("span",{},void 0,Object(a.a)(m.b,{id:"compose_form.encryption_warning",defaultMessage:"Posts on Mastodon are not end-to-end encrypted. Do not share any dangerous information over Mastodon."})," ",Object(a.a)("a",{href:"/terms",target:"_blank"},void 0,Object(a.a)(m.b,{id:"compose_form.direct_message_warning_learn_more",defaultMessage:"Learn more"})))),emptyMessage:Object(a.a)(m.b,{id:"empty_column.direct",defaultMessage:"You don't have any direct messages yet. When you send or receive one, it will show up here."})}):Object(a.a)(c.a,{trackScroll:!r,scrollKey:"direct_timeline-"+s,timelineId:"direct",onLoadMore:this.handleLoadMoreTimeline,prepend:Object(a.a)("div",{className:"follow_requests-unlocked_explanation"},void 0,Object(a.a)("span",{},void 0,Object(a.a)(m.b,{id:"compose_form.encryption_warning",defaultMessage:"Posts on Mastodon are not end-to-end encrypted. Do not share any dangerous information over Mastodon."})," ",Object(a.a)("a",{href:"/terms",target:"_blank"},void 0,Object(a.a)(m.b,{id:"compose_form.direct_message_warning_learn_more",defaultMessage:"Learn more"})))),emptyMessage:Object(a.a)(m.b,{id:"empty_column.direct",defaultMessage:"You don't have any direct messages yet. When you send or receive one, it will show up here."})}),i.a.createElement(d.a,{bindToDocument:!o,ref:this.setRef,label:e.formatMessage(te.title)},Object(a.a)(l.a,{icon:"envelope",active:t,title:e.formatMessage(te.title),onPin:this.handlePin,onMove:this.handleMove,onClick:this.handleHeaderClick,pinned:r,multiColumn:o},void 0,Object(a.a)(_,{})),h)}})||$)||$}}]);
//# sourceMappingURL=direct_timeline-ccd0b96b32c2ba26d4aa.chunk.js.map