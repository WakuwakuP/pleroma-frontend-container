(window.webpackJsonp=window.webpackJsonp||[]).push([[83],{1121:function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return oe}));var s,a=n(0),i=n(1),o=n.n(i),c=n(12),r=n(41),l=n(1316),d=n(1302),u=n(1294),m=n(373),h=n(4),p=n(1315),g=n(1362);const b=Object(h.f)({filter_regex:{id:"home.column_settings.filter_regex",defaultMessage:"Filter out by regular expressions"},settings:{id:"home.settings",defaultMessage:"Column settings"}});let v=Object(h.g)(s=class extends o.a.PureComponent{render(){const{settings:e,onChange:t,intl:n}=this.props;return Object(a.a)("div",{},void 0,Object(a.a)("span",{className:"column-settings__section"},void 0,Object(a.a)(h.b,{id:"home.column_settings.basic",defaultMessage:"Basic"})),Object(a.a)("div",{className:"column-settings__row"},void 0,Object(a.a)(p.a,{prefix:"home_timeline",settings:e,settingPath:["shows","reblog"],onChange:t,label:Object(a.a)(h.b,{id:"home.column_settings.show_reblogs",defaultMessage:"Show boosts"})})),Object(a.a)("div",{className:"column-settings__row"},void 0,Object(a.a)(p.a,{prefix:"home_timeline",settings:e,settingPath:["shows","reply"],onChange:t,label:Object(a.a)(h.b,{id:"home.column_settings.show_replies",defaultMessage:"Show replies"})})),Object(a.a)("div",{className:"column-settings__row"},void 0,Object(a.a)(p.a,{prefix:"home_timeline",settings:e,settingPath:["shows","direct"],onChange:t,label:Object(a.a)(h.b,{id:"home.column_settings.show_direct",defaultMessage:"Show DMs"})})),Object(a.a)("span",{className:"column-settings__section"},void 0,Object(a.a)(h.b,{id:"home.column_settings.advanced",defaultMessage:"Advanced"})),Object(a.a)("div",{className:"column-settings__row"},void 0,Object(a.a)(g.a,{prefix:"home_timeline",settings:e,settingPath:["regex","body"],onChange:t,label:n.formatMessage(b.filter_regex)})))}})||s;var j=n(83);var f,_,O=Object(c.connect)((e=>({settings:e.getIn(["settings","home"])})),(e=>({onChange(t,n){e(Object(j.c)(["home",...t],n))},onSave(){e(Object(j.d)())}})))(v),M=n(618),R=n(142),x=n(18),y=n(282),k=n.n(y),C=n(16),w=n.n(C),I=n(3),A=n.n(I),P=n(45),N=n(28),q=n(14),S=n(144),L=n(73),E=n.n(L),D=n(7),T=n.n(D),z=n(983),F=n(403),H=n(310),Y=n.n(H),K=n(26),U=n.n(K),G=n(132);const B=Object(h.f)({close:{id:"lightbox.close",defaultMessage:"Close"},previous:{id:"lightbox.previous",defaultMessage:"Previous"},next:{id:"lightbox.next",defaultMessage:"Next"}});class J extends x.a{constructor(){super(...arguments),this.setRef=e=>{this.node=e},this.onMentionClick=(e,t)=>{!this.context.router||0!==t.button||t.ctrlKey||t.metaKey||(t.preventDefault(),this.context.router.history.push("/@"+e.get("acct")))},this.onHashtagClick=(e,t)=>{e=e.replace(/^#/,""),!this.context.router||0!==t.button||t.ctrlKey||t.metaKey||(t.preventDefault(),this.context.router.history.push("/tags/"+e))},this.onStatusClick=(e,t)=>{!this.context.router||0!==t.button||t.ctrlKey||t.metaKey||(t.preventDefault(),this.context.router.history.push("/@"+e.getIn(["account","acct"])+"/"+e.get("id")))},this.handleMouseEnter=e=>{let{currentTarget:t}=e;if(q.autoPlayGif)return;const n=t.querySelectorAll(".custom-emoji");for(var s=0;s<n.length;s++){let e=n[s];e.src=e.getAttribute("data-original")}},this.handleMouseLeave=e=>{let{currentTarget:t}=e;if(q.autoPlayGif)return;const n=t.querySelectorAll(".custom-emoji");for(var s=0;s<n.length;s++){let e=n[s];e.src=e.getAttribute("data-static")}}}componentDidMount(){this._updateLinks()}componentDidUpdate(){this._updateLinks()}_updateLinks(){const e=this.node;if(!e)return;const t=e.querySelectorAll("a");for(var n=0;n<t.length;++n){let e=t[n];if(e.classList.contains("status-link"))continue;e.classList.add("status-link");let s=this.props.announcement.get("mentions").find((t=>e.href===t.get("url")));if(s)e.addEventListener("click",this.onMentionClick.bind(this,s),!1),e.setAttribute("title",s.get("acct"));else if("#"===e.textContent[0]||e.previousSibling&&e.previousSibling.textContent&&"#"===e.previousSibling.textContent[e.previousSibling.textContent.length-1])e.addEventListener("click",this.onHashtagClick.bind(this,e.text),!1);else{let t=this.props.announcement.get("statuses").find((t=>e.href===t.get("url")));t&&e.addEventListener("click",this.onStatusClick.bind(this,t),!1),e.setAttribute("title",e.href),e.classList.add("unhandled-link")}e.setAttribute("target","_blank"),e.setAttribute("rel","noopener noreferrer")}}render(){const{announcement:e}=this.props;return o.a.createElement("div",{className:"announcements__item__content translate",ref:this.setRef,dangerouslySetInnerHTML:{__html:e.get("contentHtml")},onMouseEnter:this.handleMouseEnter,onMouseLeave:this.handleMouseLeave})}}J.contextTypes={router:A.a.object},J.propTypes={announcement:w.a.map.isRequired};class W extends o.a.PureComponent{render(){const{emoji:e,emojiMap:t,hovered:n}=this.props;if(E.a[e]){const{filename:t,shortCode:n}=E.a[this.props.emoji],s=n?":"+n+":":"";return Object(a.a)("img",{draggable:"false",className:"emojione",alt:e,title:s,src:G.a+"/emoji/"+t+".svg"})}if(t.get(e)){const s=q.autoPlayGif||n?t.getIn([e,"url"]):t.getIn([e,"static_url"]),i=":"+e+":";return Object(a.a)("img",{draggable:"false",className:"emojione custom-emoji",alt:i,title:i,src:s})}return null}}class Q extends x.a{constructor(){super(...arguments),this.state={hovered:!1},this.handleClick=()=>{const{reaction:e,announcementId:t,addReaction:n,removeReaction:s}=this.props;e.get("me")?s(t,e.get("name")):n(t,e.get("name"))},this.handleMouseEnter=()=>this.setState({hovered:!0}),this.handleMouseLeave=()=>this.setState({hovered:!1})}render(){const{reaction:e}=this.props;let t=e.get("name");return E.a[t]&&(t=E.a[t].shortCode),Object(a.a)("button",{className:T()("reactions-bar__item",{active:e.get("me")}),onClick:this.handleClick,onMouseEnter:this.handleMouseEnter,onMouseLeave:this.handleMouseLeave,title:":"+t+":",style:this.props.style},void 0,Object(a.a)("span",{className:"reactions-bar__item__emoji"},void 0,Object(a.a)(W,{hovered:this.state.hovered,emoji:e.get("name"),emojiMap:this.props.emojiMap})),Object(a.a)("span",{className:"reactions-bar__item__count"},void 0,Object(a.a)(F.a,{value:e.get("count")})))}}Q.propTypes={announcementId:A.a.string.isRequired,reaction:w.a.map.isRequired,addReaction:A.a.func.isRequired,removeReaction:A.a.func.isRequired,emojiMap:w.a.map.isRequired,style:A.a.object};class V extends x.a{constructor(){super(...arguments),this.handleEmojiPick=e=>{const{addReaction:t,announcementId:n}=this.props;t(n,e.native.replace(/:/g,""))}}willEnter(){return{scale:q.reduceMotion?1:0}}willLeave(){return{scale:q.reduceMotion?0:U()(0,{stiffness:170,damping:26})}}render(){const{reactions:e}=this.props,t=e.filter((e=>e.get("count")>0)),n=t.map((e=>({key:e.get("name"),data:e,style:{scale:q.reduceMotion?1:U()(1,{stiffness:150,damping:13})}}))).toArray();return Object(a.a)(Y.a,{styles:n,willEnter:this.willEnter,willLeave:this.willLeave},void 0,(e=>Object(a.a)("div",{className:T()("reactions-bar",{"reactions-bar--empty":t.isEmpty()})},void 0,e.map((e=>{let{key:t,data:n,style:s}=e;return Object(a.a)(Q,{reaction:n,style:{transform:"scale("+s.scale+")",position:s.scale<.5?"absolute":"static"},announcementId:this.props.announcementId,addReaction:this.props.addReaction,removeReaction:this.props.removeReaction,emojiMap:this.props.emojiMap},t)})),t.size<8&&Object(a.a)(z.a,{onPickEmoji:this.handleEmojiPick,button:Object(a.a)(N.a,{id:"plus"})}))))}}V.propTypes={announcementId:A.a.string.isRequired,reactions:w.a.list.isRequired,addReaction:A.a.func.isRequired,removeReaction:A.a.func.isRequired,emojiMap:w.a.map.isRequired};class X extends x.a{constructor(){super(...arguments),this.state={unread:!this.props.announcement.get("read")}}componentDidUpdate(){const{selected:e,announcement:t}=this.props;e||this.state.unread===!t.get("read")||this.setState({unread:!t.get("read")})}render(){const{announcement:e}=this.props,{unread:t}=this.state,n=e.get("starts_at")&&new Date(e.get("starts_at")),s=e.get("ends_at")&&new Date(e.get("ends_at")),i=new Date,o=n&&s,c=o&&n.getFullYear()===s.getFullYear()&&s.getFullYear()===i.getFullYear(),r=o&&n.getDate()===s.getDate()&&n.getMonth()===s.getMonth()&&n.getFullYear()===s.getFullYear(),l=e.get("all_day");return Object(a.a)("div",{className:"announcements__item"},void 0,Object(a.a)("strong",{className:"announcements__item__range"},void 0,Object(a.a)(h.b,{id:"announcement.announcement",defaultMessage:"Announcement"}),o&&Object(a.a)("span",{},void 0," Â· ",Object(a.a)(h.a,{value:n,hour12:!1,year:c||n.getFullYear()===i.getFullYear()?void 0:"numeric",month:"short",day:"2-digit",hour:l?void 0:"2-digit",minute:l?void 0:"2-digit"})," - ",Object(a.a)(h.a,{value:s,hour12:!1,year:c||s.getFullYear()===i.getFullYear()?void 0:"numeric",month:r?void 0:"short",day:r?void 0:"2-digit",hour:l?void 0:"2-digit",minute:l?void 0:"2-digit"}))),Object(a.a)(J,{announcement:e}),Object(a.a)(V,{reactions:e.get("reactions"),announcementId:e.get("id"),addReaction:this.props.addReaction,removeReaction:this.props.removeReaction,emojiMap:this.props.emojiMap}),t&&Object(a.a)("span",{className:"announcements__item__unread"}))}}X.propTypes={announcement:w.a.map.isRequired,emojiMap:w.a.map.isRequired,addReaction:A.a.func.isRequired,removeReaction:A.a.func.isRequired,intl:A.a.object.isRequired,selected:A.a.bool};let Z=Object(h.g)(((_=class extends x.a{constructor(){super(...arguments),this.state={index:0},this.handleChangeIndex=e=>{this.setState({index:e%this.props.announcements.size})},this.handleNextClick=()=>{this.setState({index:(this.state.index+1)%this.props.announcements.size})},this.handlePrevClick=()=>{this.setState({index:(this.props.announcements.size+this.state.index-1)%this.props.announcements.size})}}static getDerivedStateFromProps(e,t){return e.announcements.size>0&&t.index>=e.announcements.size?{index:e.announcements.size-1}:null}componentDidMount(){this._markAnnouncementAsRead()}componentDidUpdate(){this._markAnnouncementAsRead()}_markAnnouncementAsRead(){const{dismissAnnouncement:e,announcements:t}=this.props,{index:n}=this.state,s=t.get(n);s.get("read")||e(s.get("id"))}render(){const{announcements:e,intl:t}=this.props,{index:n}=this.state;return e.isEmpty()?null:Object(a.a)("div",{className:"announcements"},void 0,Object(a.a)("img",{className:"announcements__mastodon",alt:"",draggable:"false",src:q.mascot||S.default}),Object(a.a)("div",{className:"announcements__container"},void 0,Object(a.a)(k.a,{animateHeight:!q.reduceMotion,adjustHeight:q.reduceMotion,index:n,onChangeIndex:this.handleChangeIndex},void 0,e.map(((e,s)=>Object(a.a)(X,{announcement:e,emojiMap:this.props.emojiMap,addReaction:this.props.addReaction,removeReaction:this.props.removeReaction,intl:t,selected:n===s,disabled:q.disableSwiping},e.get("id"))))),e.size>1&&Object(a.a)("div",{className:"announcements__pagination"},void 0,Object(a.a)(P.a,{disabled:1===e.size,title:t.formatMessage(B.previous),icon:"chevron-left",onClick:this.handlePrevClick,size:13}),Object(a.a)("span",{},void 0,n+1," / ",e.size),Object(a.a)(P.a,{disabled:1===e.size,title:t.formatMessage(B.next),icon:"chevron-right",onClick:this.handleNextClick,size:13}))))}}).propTypes={announcements:w.a.list,emojiMap:w.a.map.isRequired,dismissAnnouncement:A.a.func.isRequired,addReaction:A.a.func.isRequired,removeReaction:A.a.func.isRequired,intl:A.a.object.isRequired},f=_))||f;var $=n(39),ee=n(2);const te=Object($.a)([e=>e.get("custom_emojis")],(e=>e.reduce(((e,t)=>e.set(t.get("shortcode"),t)),Object(ee.Map)())));var ne,se=Object(c.connect)((e=>({announcements:e.getIn(["announcements","items"]),emojiMap:te(e)})),(e=>({dismissAnnouncement:t=>e(Object(R.o)(t)),addReaction:(t,n)=>e(Object(R.m)(t,n)),removeReaction:(t,n)=>e(Object(R.q)(t,n))})))(Z),ae=n(1363);const ie=Object(h.f)({title:{id:"column.home",defaultMessage:"Home"},show_announcements:{id:"home.show_announcements",defaultMessage:"Show announcements"},hide_announcements:{id:"home.hide_announcements",defaultMessage:"Hide announcements"}});let oe=Object(c.connect)((e=>({hasUnread:e.getIn(["timelines","home","unread"])>0,isPartial:e.getIn(["timelines","home","isPartial"]),hasAnnouncements:!e.getIn(["announcements","items"]).isEmpty(),unreadAnnouncements:e.getIn(["announcements","items"]).count((e=>!e.get("read"))),showAnnouncements:e.getIn(["announcements","show"])})))(ne=Object(h.g)(ne=class extends o.a.PureComponent{constructor(){super(...arguments),this.handlePin=()=>{const{columnId:e,dispatch:t}=this.props;t(e?Object(m.h)(e):Object(m.e)("HOME",{}))},this.handleMove=e=>{const{columnId:t,dispatch:n}=this.props;n(Object(m.g)(t,e))},this.handleHeaderClick=()=>{this.column.scrollTop()},this.setRef=e=>{this.column=e},this.handleLoadMore=e=>{this.props.dispatch(Object(r.v)({maxId:e}))},this.handleToggleAnnouncementsClick=e=>{e.stopPropagation(),this.props.dispatch(Object(R.r)())}}componentDidMount(){setTimeout((()=>this.props.dispatch(Object(R.p)())),700),this._checkIfReloadNeeded(!1,this.props.isPartial)}componentDidUpdate(e){this._checkIfReloadNeeded(e.isPartial,this.props.isPartial)}componentWillUnmount(){this._stopPolling()}_checkIfReloadNeeded(e,t){const{dispatch:n}=this.props;e!==t&&(!e&&t?this.polling=setInterval((()=>{n(Object(r.v)())}),3e3):e&&!t&&this._stopPolling())}_stopPolling(){this.polling&&(clearInterval(this.polling),this.polling=null)}render(){const{intl:e,hasUnread:t,columnId:n,multiColumn:s,hasAnnouncements:i,unreadAnnouncements:c,showAnnouncements:r}=this.props,m=!!n;let p=null;return i&&(p=Object(a.a)("button",{className:T()("column-header__button",{active:r}),title:e.formatMessage(r?ie.hide_announcements:ie.show_announcements),"aria-label":e.formatMessage(r?ie.hide_announcements:ie.show_announcements),"aria-pressed":r?"true":"false",onClick:this.handleToggleAnnouncementsClick},void 0,Object(a.a)(ae.a,{id:"bullhorn",count:c}))),o.a.createElement(d.a,{bindToDocument:!s,ref:this.setRef,name:"home",label:e.formatMessage(ie.title)},Object(a.a)(u.a,{icon:"home",active:t,title:e.formatMessage(ie.title),onPin:this.handlePin,onMove:this.handleMove,onClick:this.handleHeaderClick,pinned:m,multiColumn:s,extraButton:p,appendContent:i&&r&&Object(a.a)(se,{})},void 0,Object(a.a)(O,{})),Object(a.a)(l.a,{trackScroll:!m,scrollKey:"home_timeline-"+n,onLoadMore:this.handleLoadMore,timelineId:"home",emptyMessage:Object(a.a)(h.b,{id:"empty_column.home",defaultMessage:"Your home timeline is empty! Follow more people to fill it up. {suggestions}",values:{suggestions:Object(a.a)(M.a,{to:"/start"},void 0,Object(a.a)(h.b,{id:"empty_column.home.suggestions",defaultMessage:"See some suggestions"}))}}),bindToDocument:!s}))}})||ne)||ne},144:function(e,t,n){"use strict";n.r(t),t.default=n.p+"media/images/elephant_ui_plane-72f8702db120a51a1cdbc4fb7f5ef59d.svg"}}]);
//# sourceMappingURL=home_timeline-4d787637308cc73bfd6b.chunk.js.map